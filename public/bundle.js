(()=>{"use strict";var e,t={139:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function s(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,o,a,n,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},n=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var o,a=0,n=t.length;a<n;a++)!o&&a in t||(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var i=r(817),s=r(228),c=function(){function e(){}return e.onHeaderSearchClick=function(e){e.stopPropagation(),this.searchViewOpen?this.hideSearchView():this.showSearchView()},e.closeSearchByClick=function(e){this.searchViewOpen&&!this.$viewSearch[0].contains(e.target)&&(this.$viewSearch.hide(),this.searchViewOpen=!1,e.preventDefault())},e.onSearchInputKeyDown=function(e){if("Enter"===e.key){if(""===this.$searchInput.val())return void this.search();if(this.selectedAutocompleteTag>-1)(r=this.$autocompleteTags.children()).eq(this.selectedAutocompleteTag).trigger("click");else{this.suppressAutocomplete=!0;var t=this.$searchInput.val();this.addSearchTag(t),this.$searchInput.val(""),this.$autocompleteTags.empty(),this.$autocompleteTags.hide()}}else if("ArrowDown"==e.key){e.preventDefault(),this.selectedAutocompleteTag++;var r=this.$autocompleteTags.children();this.selectedAutocompleteTag>=r.length&&(this.selectedAutocompleteTag=0),this.selectAutocompleteTag(this.selectedAutocompleteTag)}else"ArrowUp"==e.key?(e.preventDefault(),this.selectedAutocompleteTag--,this.selectedAutocompleteTag<0&&(this.selectedAutocompleteTag=this.$autocompleteTags.children().length-1),this.selectAutocompleteTag(this.selectedAutocompleteTag)):"Escape"==e.key&&(this.selectedAutocompleteTag>-1?this.unselectAutocompleteTags():this.hideSearchView())},e.onSearchInputChange=function(){var e=this;this.suppressAutocomplete?this.suppressAutocomplete=!1:i.default.current.autocompleteEnabled?i.default.current.autocomplete(this.$searchInput.val(),(function(t){e.updateAutocompleteTags(t)}),(function(){}),(function(e){console.error(e)})):this.$autocompleteTags.hide()},e.onSearchCancelClick=function(e){e.stopPropagation(),this.$resultsFooterText.text("Currently showing "+this.posts.length+' images.\n\nNote that due to technical limitations, if you click "Show more...", you will get some repeat posts.'),this.$btnFooterSearch.hide(),this.$btnLoadMore.show(),this.$btnCancelSearch.hide(),i.default.current.abortSearch()},e.onNextPostClick=function(e){var t=this;null==e||e.stopPropagation(),this.currentPost<this.posts.length-1&&this.openPost(this.posts[++this.currentPost],(function(){t.currentPost<t.posts.length-1&&t.preloadImage(t.posts[t.currentPost+1].getLargeImage(),(function(e){t.cachedImage=e}))})),this.$btnNextPost.trigger("blur")},e.onPrevPostClick=function(e){var t=this;null==e||e.stopPropagation(),this.currentPost>0&&this.openPost(this.posts[--this.currentPost],(function(){t.currentPost>0&&t.preloadImage(t.posts[t.currentPost-1].getLargeImage(),(function(e){t.cachedImage=e}))})),this.$btnPrevPost.trigger("blur")},e.onWindowKeyDown=function(e){this.openedPost&&("ArrowRight"===e.key?this.onNextPostClick():"ArrowLeft"===e.key&&this.onPrevPostClick())},e.onCopyButtonPressed=function(e){var t=this;e.stopPropagation();var r="".concat(window.location.origin,"/post/").concat(this.openedPost.site.id,"/").concat(this.openedPost.id),o=document.createElement("textarea");o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.width="2em",o.style.height="2em",o.style.padding="0",o.style.border="none",o.style.outline="none",o.style.boxShadow="none",o.style.background="transparent",o.value=r,document.body.appendChild(o),o.focus(),o.select();try{var a=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+a)}catch(e){console.log("Oops, unable to copy")}document.body.removeChild(o),this.$btnCopyLink.text("Copied!"),setTimeout((function(){t.$btnCopyLink.text("Copy link")}),2e3),this.$btnCopyLink.trigger("blur")},e.onDownloadButtonPressed=function(e){e.stopPropagation();var t=(0,s.proxify)(i.default.current.id,this.openedPost.getFullSizeImage()),r=t.split(".").pop(),o="".concat(this.openedPost.site.id,"-").concat(this.openedPost.id,".").concat(r),a=document.createElement("a");a.href=t,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),this.$btnDownload.trigger("blur")},e.onClosePostClick=function(e){e.stopPropagation(),this.$postPlaceholder.show(),this.$post.hide(),this.$postVideo.trigger("pause"),this.$postVideo.attr("src",""),this.$postVideo.attr("poster",""),this.$postImage.attr("src",""),this.$postDownscaleWarning.hide(),window.innerWidth<1e3&&(this.$paneLeft.show(),this.$paneRight.hide()),this.openedPost=void 0},e.onWindowResize=function(){!this.openedPost&&window.innerWidth<1e3&&this.$paneRight.hide()},e.arraySetEquals=function(e,t){if(void 0===e||void 0===t)return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0,o=e;r<o.length;r++){var a=o[r];if(!t.includes(a))return!1}for(var n=0,i=t;n<i.length;n++)if(a=i[n],!e.includes(a))return!1;return!0},e.preloadImage=function(e,t){var r=new Image;r.onload=t.bind(this,r),r.src=e},e.search=function(e){var t=this;if(void 0===e&&(e=!1),!e&&this.lastSearch&&i.default.current==this.lastSearch.site&&this.arraySetEquals(this.searchTags,this.lastSearch.tags)&&this.currentPage==this.lastSearch.page&&this.safeSearchEnabled==this.lastSearch.safeSearch)console.log("Same search. Cancelling.");else{console.log("Searching: "+this.searchTags.join(", ")),window.history.replaceState({},"","?".concat(this.safeSearchEnabled?"":"nsfw=true&","site=").concat(i.default.current.id,"&tags=").concat(this.searchTags.join(","))),e||(this.currentPage=0),this.$resultsPlaceholder.hide(),this.$results.show(),this.$resultsFooter.show(),this.$resultsFooterText.text("Loading..."),this.$btnFooterSearch.hide(),this.$btnLoadMore.hide(),this.$btnCancelSearch.show(),e||this.clearResults();var r=this.searchTags.some((function(e){return e.startsWith("id:")}));this.lastSearch={tags:n([],this.searchTags,!0),page:this.currentPage,safeSearch:this.safeSearchEnabled,site:i.default.current},i.default.current.search(n([],this.searchTags,!0),this.currentPage,this.safeSearchEnabled&&!r,(function(e){return o(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map(this.addPost.bind(this)))];case 1:return t.sent(),r&&this.posts.length>0&&(this.openPost(this.posts[0]),r=!1),[2]}}))}))}),(function(e,r){t.currentPage=e,r?(t.$resultsFooterText.text("No more images found."),t.$btnFooterSearch.show(),t.$btnLoadMore.hide(),t.$btnCancelSearch.hide()):(t.$resultsFooterText.text(""),t.$btnFooterSearch.hide(),t.$btnLoadMore.show(),t.$btnCancelSearch.hide())}),(function(e){return console.error(e)})),this.hideSearchView()}},e.clearResults=function(){this.$resultsLeftColumn.empty(),this.$resultsRightColumn.empty(),this.leftColumnHeight=0,this.rightColumnHeight=0,this.posts=[]},e.addPost=function(e){var t=this;return new Promise((function(r,o){var a=new Image;a.onload=function(){t.leftColumnHeight<=t.rightColumnHeight?(t.$resultsLeftColumn.append(a),t.leftColumnHeight+=e.normalisedHeight()):(t.$resultsRightColumn.append(a),t.rightColumnHeight+=e.normalisedHeight()),t.posts.push(e),r()},a.onclick=function(r){r.stopPropagation(),t.openPost(e)},a.onerror=o,a.src=e.getThumbnail(),a.className="results-image"}))},e.unselectAutocompleteTags=function(){this.selectedAutocompleteTag=-1,this.$autocompleteTags.children().removeClass("selected")},e.selectAutocompleteTag=function(e){if(this.selectedAutocompleteTag=e,!(this.selectedAutocompleteTag<0)){var t=this.$autocompleteTags.children();this.selectedAutocompleteTag>=t.length||(t.removeClass("selected"),t.eq(this.selectedAutocompleteTag).addClass("selected"))}},e.updateAutocompleteTags=function(e){var t=this;if(this.unselectAutocompleteTags(),0!=e.length){this.$autocompleteTags.show(),this.$autocompleteTags.empty();for(var r=function(e){var r=$('<button class="autocomplete-tag tag-'.concat(e.type,'">').concat(e.label,"</button>"));r.on("click touchstart",(function(r){t.suppressAutocomplete=!0,r.stopPropagation(),r.preventDefault(),t.addSearchTag(e.value),t.$searchInput.val(""),t.$autocompleteTags.empty(),t.$autocompleteTags.hide()})),o.$autocompleteTags.append(r)},o=this,a=0,n=e;a<n.length;a++)r(n[a])}else this.$autocompleteTags.hide()},e.showSearchView=function(){this.$viewSearch.show(),this.searchViewOpen=!0,this.$searchInput.trigger("focus")},e.hideSearchView=function(){this.$viewSearch.hide(),this.searchViewOpen=!1,this.$searchInput.val(""),this.$autocompleteTags.hide(),this.$autocompleteTags.empty(),this.unselectAutocompleteTags()},e.addSearchTag=function(e){var t=this;if(e=e.trim(),!this.searchTags.includes(e)){this.searchTags.push(e);var r=$('<span class="search-tag">'.concat(e,' <span class="search-tag-close">&#x2715</span></span>'));r.one("click",(function(o){o.stopPropagation(),t.searchTags.splice(t.searchTags.indexOf(e),1),r.remove(),0===t.searchTags.length&&(t.$searchTagDisplay.hide(),t.$searchTagHeaderNoTags.show())})),this.$searchTagHeaderNoTags.hide(),this.$searchCurrentTags.append(r),this.$searchTagDisplay.show()}},e.clearSearchTags=function(){this.searchTags=[],this.$searchCurrentTags.empty(),this.$searchTagDisplay.hide(),this.$searchTagHeaderNoTags.show()},e.setSafeSearchEnabled=function(e){this.safeSearchEnabled=e,this.$btnSafeSearch.text(this.safeSearchEnabled?"Safe Search: ON":"Safe Search: OFF");var t=this.$selectSearchSite.children(".nsfw-site");this.safeSearchEnabled?(t.attr("disabled",""),t.attr("hidden","")):(t.removeAttr("disabled"),t.removeAttr("hidden"))},e.openPost=function(e,t){var r=this;if(!this.openedPost||this.openedPost.id!==e.id){if(window.innerWidth<1e3?this.$paneLeft.hide():this.$paneLeft.show(),this.$postPlaceholder.hide(),this.$post.show(),this.$paneRight.show(),this.currentPost=this.posts.indexOf(e),console.log("Opening post "+this.currentPost),this.$postPlaceholder.hide(),this.$post.show(),e.requiresVideoPlayer)this.$postImage.hide(),this.$postVideo.show(),this.$postVideo.attr("poster",e.getThumbnail()),this.$postVideo.attr("src",e.getLargeImage()),this.$postVideo.trigger("play");else{this.$postVideo.hide(),this.$postImage.show();var o=this.cachedImage&&this.cachedImage.src===e.getLargeImage()?1:0;this.$postImage.attr("src",e.imageResolutions[o]);var a=this.$postImage[0];a.onload=function(){o>0&&t&&t();var n=Math.round(a.height/a.naturalHeight*100),i=Math.round(a.naturalHeight/e.fullHeight*100);a.naturalHeight<a.height&&n>150&&o<e.imageResolutions.length-1&&(o++,r.$postImage.attr("src",e.imageResolutions[o])),i<100?(r.$postDownscaleWarning.show(),r.$postDownscaleWarning.text("Resized to ".concat(i,"% of original"))):r.$postDownscaleWarning.hide()},a.onerror=function(){r.$postImage.attr("src",e.getThumbnail())}}if(this.$postInfoHeader.text("".concat(e.site.name," #").concat(e.id)),this.openedPost&&this.openedPost.site===e.site){for(var n in e.properties)this.postProperties[n].html("<b>".concat(n,"</b>: ").concat(e.properties[n]));for(var n in e.tagTypes)this.postTagTypes[n].text(e.tagTypes[n].join(" "))}else{for(var n in this.$postInfo.empty(),e.properties)if(e.properties[n]){var i=$('<span class="post-property"><b>'.concat(n,"</b>: ").concat(e.properties[n],"</span>"));this.postProperties[n]=i,this.$postInfo.append(i)}for(var n in this.$postTagTypes.empty(),e.tagTypes){var s=e.tagTypes[n];if(s&&0!=s.length){var c=$('<div class="post-tag-type"></div>'),l=$('<h3 class="post-tag-type-header"><b>'.concat(n,"</b></h3>"));c.append(l);var u=$('<span class="post-tag-list tag-'.concat(n.toLowerCase(),'">').concat(s.join(" "),"</span>"));c.append(u),this.postTagTypes[n]=u,this.$postTagTypes.append(c)}}}0===this.currentPost?this.$btnPrevPost.addClass("invisible"):this.$btnPrevPost.removeClass("invisible"),this.currentPost===this.posts.length-1?this.$btnNextPost.addClass("invisible"):this.$btnNextPost.removeClass("invisible"),this.openedPost=e}},e.main=function(){var e=this;if(this.$btnHeaderSearch=$("#header-search, #results-placeholder, #btn-different-search"),this.$viewSearch=$("#view-search"),this.$viewSearch.hide(),this.$searchInput=$("#search-input"),this.$searchCurrentTags=$("#search-current-tags"),this.$searchTagHeaderNoTags=$("#search-tag-header-no-tags"),this.$searchTagDisplay=$("#search-tag-display"),this.$searchTagDisplay.hide(),this.$btnClearTags=$("#btn-clear"),this.$btnExitSearch=$("#btn-exit-search"),this.$selectSearchSite=$("#search-site"),this.$btnSearch=$("#btn-search"),this.$resultsLeftColumn=$("#results-column-left"),this.$resultsRightColumn=$("#results-column-right"),this.$resultsPlaceholder=$("#results-placeholder"),this.$results=$("#results"),this.$resultsFooter=$("#results-footer"),this.$resultsFooterText=$("#results-footer-text"),this.$btnFooterSearch=$("#btn-different-search"),this.$btnLoadMore=$("#btn-load-more"),this.$autocompleteTags=$("#search-autocomplete"),this.$btnCancelSearch=$("#btn-cancel-search"),this.$postPlaceholder=$("#post-placeholder"),this.$post=$("#post"),this.$postImage=$("#post-image"),this.$postDownscaleWarning=$("#post-downscale-warning"),this.$btnPrevPost=$("#btn-prev-post"),this.$btnViewFullsize=$("#btn-view-fullsize"),this.$btnOpenOriginalPost=$("#btn-open-original"),this.$btnNextPost=$("#btn-next-post"),this.$btnCopyLink=$("#btn-copy-link"),this.$btnDownload=$("#btn-download"),this.$btnClosePost=$("#btn-close-post"),this.$postInfo=$("#post-info"),this.$postPropertySite=$("#post-property-site"),this.$postPropertyId=$("#post-property-id"),this.$postTagTypes=$("#post-tag-types"),this.$postVideo=$("#post-video"),this.$postInfoHeader=$("#post-info-header"),this.$paneLeft=$("#pane-left"),this.$paneRight=$("#pane-right"),this.$btnSafeSearch=$("#btn-safe-search"),this.$btnHeaderSearch.on("click",this.onHeaderSearchClick.bind(this)),this.$searchInput.on("keydown",this.onSearchInputKeyDown.bind(this)),this.$searchInput.on("input",this.onSearchInputChange.bind(this)),window.addEventListener("click",this.closeSearchByClick.bind(this)),this.$btnClearTags.on("click",(function(t){t.stopPropagation(),e.clearSearchTags()})),this.$btnExitSearch.on("click",(function(t){t.stopPropagation(),e.hideSearchView()})),this.$selectSearchSite.append(i.default.getAll().map((function(e){return'<option value="'.concat(e.id,'" ').concat(e.isPorn?'class="nsfw-site"':"",">").concat(e.name,"</option>")})).join("")),this.$selectSearchSite.on("change",(function(t){var r=i.default.find(e.$selectSearchSite.val());i.default.current=r,i.default.current.onSelected(),e.$autocompleteTags.empty(),e.$autocompleteTags.hide()})),this.safeSearchEnabled){var t=this.$selectSearchSite.children(".nsfw-site");t.attr("disabled",""),t.attr("hidden","")}i.default.current=i.default.getAll()[0],this.$btnSearch.on("click",(function(t){t.stopPropagation(),e.search()})),this.$btnLoadMore.on("click",(function(t){t.stopPropagation(),e.currentPage++,e.search(!0)})),this.$btnViewFullsize.on("click",(function(t){t.stopPropagation(),window.open(e.openedPost.getFullSizeImage(),"_blank"),e.$btnViewFullsize.trigger("blur")})),this.$btnOpenOriginalPost.on("click",(function(t){t.stopPropagation(),window.open(e.openedPost.originalPost,"_blank"),e.$btnOpenOriginalPost.trigger("blur")})),this.$btnCancelSearch.on("click",this.onSearchCancelClick.bind(this)),this.$btnPrevPost.on("click",this.onPrevPostClick.bind(this)),this.$btnNextPost.on("click",this.onNextPostClick.bind(this)),this.$btnCopyLink.on("click",this.onCopyButtonPressed.bind(this)),this.$btnDownload.on("click",this.onDownloadButtonPressed.bind(this)),this.$btnClosePost.on("click",this.onClosePostClick.bind(this)),$(window).on("keydown",this.onWindowKeyDown.bind(this)),$(window).on("resize",this.onWindowResize.bind(this)),this.onWindowResize(),this.$postInfoHeader.on("click",(function(t){console.log(e.openedPost)})),this.$btnSafeSearch.on("click",(function(t){t.stopPropagation(),e.safeSearchEnabled&&!confirm("Are you sure you want to disable safe search?\n\nThis will allow sensitive or pornographic content to be displayed, as well as include new sites in the site dropdown that contain such content.")||e.setSafeSearchEnabled(!e.safeSearchEnabled)}));var r=new URLSearchParams(window.location.search),o=!!r.has("nsfw")&&"true"===r.get("nsfw");if(this.safeSearchEnabled=!o,this.$btnSafeSearch.text(this.safeSearchEnabled?"Safe Search: ON":"Safe Search: OFF"),r.has("domain")||r.has("site")){var a=r.get("domain")||r.get("site"),n=i.default.find(a);n&&(i.default.current=n,n.onSelected(),this.$selectSearchSite.val(a))}if(r.has("tags")||r.has("q")){var s=(r.get("tags")||r.get("q")).split(",").map((function(e){return e.trim()}));1==s.length&&"landscape"==s[0]&&s.push("no_humans");for(var c=0,l=s;c<l.length;c++){var u=l[c];""!==u.trim()&&this.addSearchTag(u)}this.search()}console.log("Frontend ready!")},e.posts=[],e.searchTags=[],e.currentPage=0,e.currentPost=-1,e.selectedAutocompleteTag=-1,e.searchViewOpen=!1,e.suppressAutocomplete=!1,e.leftColumnHeight=0,e.rightColumnHeight=0,e.safeSearchEnabled=!0,e.postTagTypes={},e.postProperties={},e}();t.default=c},160:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.label=e,this.value=t,this.type=r}return e.decompose=function(e){var t="";return(e=e.trim()).startsWith("-")&&(t="-",e=e.substring(1).trim()),{negation:t,baseTag:e}},e}();t.default=r},729:function(e,t,r){var o=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function s(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,o,a,n,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0});var n=r(228),i=r(160),s=r(536),c=function(){function e(){}return e.verifyCache=function(e,t,r){return o(this,void 0,void 0,(function(){var o,i,s,c;return a(this,(function(a){switch(a.label){case 0:if(!(localStorage.getItem(e.id+"-version")!=r||Date.now()-parseInt(localStorage.getItem(e.id+"-last-update")||"0")>6048e5))return[3,5];console.log("Fetching ".concat(e.name," tags from summary page: ").concat(t)),i=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(0,n.getJsonPromise)(t)];case 2:return i=a.sent(),[3,4];case 3:throw s=a.sent(),c="Could not fetch ".concat(e.name," (").concat(e.id,") tags from summary page"),console.log(c),console.error(s),new Error(c);case 4:return localStorage.setItem(e.id+"-version",r),localStorage.setItem(e.id+"-last-update",Date.now().toString()),localStorage.setItem(e.id+"-tags",i.data),o=i.data,console.log("Updated ".concat(e.name," (").concat(e.id,") tag cache")),[3,6];case 5:console.log("Found ".concat(e.name," (").concat(e.id,") tag cache")),o=localStorage.getItem(e.id+"-tags"),a.label=6;case 6:return[2,o]}}))}))},e.complete=function(e,t,r){var o=i.default.decompose(e),a=o.negation,n=o.baseTag;if(0==n.length||""==t)return[];var c=this.createTagSearchRegex(n,{global:!0}),l=this.retrieveTagSearch(c,t,{max_results:100});l=(l=this.reorderSearchResults(n,l)).slice(0,10),-1!="sqe".indexOf(n)&&l.unshift("0`"+n+"` ");for(var u=[],h=0,p=l;h<p.length;h++){var d=p[h],f=d.match(/(\d+)`([^`]*)`(([^ ]*)`)? /);if(!f)return console.error("Unparsable cached tag: '"+d+"'"),[];var g=a+f[2];u.push(new i.default(g,g,r[f[1]]||s.default.Other))}return u},e.createTagSearchRegex=function(e,t){void 0===t&&(t={});var r=e.split(""),o=[],a="(([^`]*_)?";if(r.forEach((function(e){var t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a+=t})),a+=")",o.push(a),-1!==e.indexOf("_")){var n=e.split("_",1)[0],i=e.slice(n.length+1),s=n.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),c=i.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a="(",a+="("+s+"[^`]*_"+c+")",a+="|",a+="("+c+"[^`]*_"+s+")",a+=")",o.push(a)}!t.top_results_only&&r.length<12&&(a="(",r.forEach((function(e){var t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a+=t,a+="[^`]*"})),a+=")",o.push(a));var l=o.join("|");return new RegExp("(\\d+)[^ ]*`("+l+")[^`]*`[^ ]* ","g")},e.retrieveTagSearch=function(e,t,r){void 0===r&&(r={});var o=[],a=10;for(void 0!==r.max_results&&(a=r.max_results);o.length<a;){var n=e.exec(t);if(!n)break;var i=n[0];-1===i.indexOf(":deletethistag:")&&-1===o.indexOf(i)&&o.push(i)}return o},e.reorderSearchResults=function(t,r){var o=e.createTagSearchRegex(t,{top_results_only:!0,global:!1}),a=[],n=[];return r.forEach((function(e){o.test(e)?a.push(e):n.push(e)})),a.concat(n)},e}();t.default=c},289:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.properties={},this.extra="",this.title=e,this.description=t}return e.prototype.build=function(){return"\n            \x3c!-- Primary Meta Tags --\x3e\n            <title>".concat(this.title,'</title>\n            <meta name="title" content="').concat(this.title,'" />\n            <meta name="description" content="').concat(this.description,'" />\n\n            \x3c!-- Open Graph / Facebook --\x3e\n            <meta property="og:type" content="website" />\n            ').concat(this.url?'<meta property="og:url" content="'.concat(this.url," />"):"",'\n            <meta property="og:title" content="').concat(this.title,'" />\n            <meta property="og:description" content="').concat(this.description,'" />\n            ').concat(this.imageUrl?'<meta property="og:image" content="'.concat(this.imageUrl,'" />'):"",'\n\n            \x3c!-- Twitter --\x3e\n            <meta property="twitter:card" content="summary_large_image" />\n            ').concat(this.url?'<meta property="twitter:url" content="'.concat(this.url," />"):"",'\n            <meta property="twitter:title" content="').concat(this.title,'" />\n            <meta property="twitter:description" content="').concat(this.description,'" />\n            ').concat(this.imageUrl?'<meta property="twitter:image" content="'.concat(this.imageUrl,'" />'):"",'\n\n            \x3c!-- Extra --\x3e\n            <meta name="twitter:card" content="summary_large_image" />\n            ').concat(this.extra,"\n        ")},e}();t.default=r},558:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.id="",this.requiresVideoPlayer=!1,this.imageResolutions=[],this.fullWidth=-1,this.fullHeight=-1,this.originalPost="",this.properties={},this.tagTypes={},this.site=e}return e.prototype.normalisedHeight=function(){return this.fullHeight/this.fullWidth},e.prototype.getThumbnail=function(){return this.imageResolutions[0]},e.prototype.getLargeImage=function(){return this.imageResolutions[1]||this.imageResolutions[0]},e.prototype.getFullSizeImage=function(){return this.imageResolutions[this.imageResolutions.length-1]},e}();t.default=r},417:function(e,t,r){var o,a=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},n.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function s(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,o,a,n,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SiteBuilder=void 0;var c=r(160),l=r(729),u=r(817);function h(e){return e}var p=function(){function e(){}return e.buildNetworkAutocomplete=function(t,r,o){void 0===o&&(o={}),o.delay=o.delay||0,o.minLength=o.minLength||1;var a=o.preprocessor||h;return o.delay>0?function(a,i,s,c){var l=e.buildNetworkAutocomplete(t,r,n(n({},o),{delay:0}));return setTimeout((function(){return l(a,i,s,c)}),o.delay)}:function(e,n,i,s){var l=c.default.decompose(e),u=l.negation,h=l.baseTag;if(h.length<(o.minLength||1))return n([]),i(),null;var p=encodeURI(t.replace("{tag}",h));return $.getJSON(p,(function(e){for(var t=[],o=0,s=a(e);o<s.length;o++){var c=s[o],l=r(c);l.label=u+l.label,l.value=u+l.value,t.push(l)}n(t),i()}))}},e.buildSearcher=function(e,t,r){return void 0===r&&(r={preprocessor:h,pageOffset:0,delimiter:" "}),function(o,a,n,i,s,c){r.safeSearchTag&&n&&(o=o.concat(r.safeSearchTag));var l=encodeURI(e.replace("{tags}",o.join(r.delimiter||" ")).replace("{page}",(a+(r.pageOffset||0)).toString()));return console.log("Searching... "+l),$.getJSON(l,(function(e){for(var o=[],n=0,c=r.preprocessor(e);n<c.length;n++){var l=c[n],u=t(l);u&&o.push(u)}console.log("Search successful"),i(o),s(a,o.length<20)})).fail(c)}},e.buildSite=function(t){if(t.autocompleteModule){if("url"in t.autocompleteModule){var r=t.autocompleteModule;return new(function(o){function n(){var a=o.call(this,t.name,t.id)||this;return a.isPorn=t.isPorn,a.autocompleteEnabled=!0,a.proxyHeaders=t.proxyHeaders||{},a.activeAutocompleteRequest=null,a.activeSearchRequest=null,a.parsePost=t.searchTransformer,a.autocompleter=e.buildNetworkAutocomplete(r.url,r.transformer,{minLength:r.minLength,delay:r.delay,preprocessor:r.preprocessor}),a.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||h,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),a}return a(n,o),n.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},n.prototype.autocomplete=function(e,t,r,o){this.abortAutocomplete(),this.activeAutocompleteRequest=this.autocompleter(e,t,r,o)||this.activeAutocompleteRequest},n.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},n.prototype.search=function(e,t,r,o,a,n){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,o,a,n)},n}(u.default))}if("summaryUrl"in t.autocompleteModule){var o=t.autocompleteModule;return new(function(r){function n(){var o=r.call(this,t.name,t.id)||this;return o.isPorn=t.isPorn,o.autocompleteEnabled=!1,o.proxyHeaders=t.proxyHeaders||{},o.tagCache="",o.activeAutocompleteRequest=null,o.activeSearchRequest=null,o.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||h,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),o}return a(n,r),n.prototype.onSelected=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this,[4,l.default.verifyCache(this,o.summaryUrl,o.version)];case 1:return e.tagCache=t.sent()||"",this.autocompleteEnabled=!0,[2]}}))}))},n.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(clearTimeout(this.activeAutocompleteRequest),this.activeAutocompleteRequest=null)},n.prototype.autocomplete=function(e,r,a,n){var i,s=this;this.abortAutocomplete(),this.activeAutocompleteRequest=setTimeout((function(){r(l.default.complete(e,s.tagCache,o.typeToEnum)),a()}),(null===(i=t.autocompleteModule)||void 0===i?void 0:i.delay)||0)},n.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},n.prototype.search=function(e,t,r,o,a,n){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,o,a,n)},n}(u.default))}}return new(function(r){function o(){var o=r.call(this,t.name,t.id)||this;return o.isPorn=t.isPorn,o.autocompleteEnabled=!1,o.proxyHeaders=t.proxyHeaders||{},o.activeSearchRequest=null,o.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||h,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),o}return a(o,r),o.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},o.prototype.search=function(e,t,r,o,a,n){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,o,a,n)},o}(u.default))},e.ExtractImagesGelboorulike=function(e){var t=[e.preview_url,e.file_url];return e.sample&&e.sample_url&&t.push(e.sample_url),t},e}();t.SiteBuilder=p},624:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(838),a=r(367),n=r(979),i=r(375),s=r(661),c=r(432),l=r(34),u=r(817);t.default=function(){u.default.register(new o.default),u.default.register(a.default),u.default.register(n.default),u.default.register(i.default),u.default.register(c.default),u.default.register(l.default),u.default.register(s.default)}},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.autocompleteEnabled=!1,this.isPorn=!1,this.proxyHeaders={},this.name=e,this.id=t}return e.find=function(t){return e.sites.find((function(e){return e.id===t}))},e.getAll=function(){return e.sites},e.register=function(t){e.sites.push(t),t.onRegistered()},e.prototype.onRegistered=function(){},e.prototype.onSelected=function(){},e.prototype.parsePost=function(e){throw new Error("parsePost not implemented")},e.prototype.autocomplete=function(e,t,r,o){o("Autocomplete not implemented")},e.prototype.abortAutocomplete=function(){},e.prototype.search=function(e,t,r,o,a,n){n("Search not implemented")},e.prototype.abortSearch=function(){},e.prototype.getPostByID=function(e,t){return new Promise((function(e,t){t("getPostByID not implemented")}))},e.prototype.generateEmbed=function(e){throw new Error("generateEmbed not implemented")},e.sites=[],e}();t.default=r},838:function(e,t,r){var o,a=this&&this.__extends||(o=function(e,t){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},o(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))((function(a,n){function i(e){try{c(o.next(e))}catch(e){n(e)}}function s(e){try{c(o.throw(e))}catch(e){n(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((o=o.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,o,a,n,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var o,a=0,n=t.length;a<n;a++)!o&&a in t||(o||(o=Array.prototype.slice.call(t,0,a)),o[a]=t[a]);return e.concat(o||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var c=r(558),l=r(817),u=r(160),h=r(536),p=r(228),d=r(417),f=r(289),g={g:"General",s:"Sensitive",q:"Questionable",e:"Explicit"},m={0:h.default.General,1:h.default.Artist,3:h.default.Copyright,4:h.default.Character,5:h.default.Meta},y=function(e){function t(){var r=e.call(this,"Danbooru","danbooru")||this;return r.autocompleteEnabled=!0,r.isPorn=!1,r.activeAutocompleteRequest=null,r.activeSearchRequest=null,r.autocompleter=d.SiteBuilder.buildNetworkAutocomplete("https://danbooru.donmai.us/autocomplete.json?only=name,post_count,category&limit=10&search[type]=tag_query&search[query]={tag}",t.autocompleteTransformFunction,{minLength:3}),r}return a(t,e),t.prototype.wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},t.autocompleteTransformFunction=function(e){return new u.default(e.post_count?"".concat(e.label," (").concat(e.post_count,")"):e.label,e.value,m[e.category]||h.default.Other)},t.prototype.autocomplete=function(e,t,r,o){this.abortAutocomplete(),this.activeSearchRequest=this.autocompleter(e,t,r,o)||this.activeSearchRequest},t.prototype.abortSearch=function(){this.activeSearchRequest&&this.activeSearchRequest.abort()},t.prototype.parsePost=function(e){if(!e.preview_file_url&&!e.large_file_url&&!e.file_url)throw new Error("Post does not contain any image");var t=new c.default(this);return t.id=e.id.toString(),t.imageResolutions=[e.preview_file_url,e.large_file_url,e.file_url],t.fullWidth=e.image_width,t.fullHeight=e.image_height,t.originalPost="https://danbooru.donmai.us/posts/".concat(e.id),t.properties={Rating:g[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.image_width,"x").concat(e.image_height,")"),Source:e.source,Date:e.created_at.split("T")[0],Score:e.score.toString(),Favourites:e.fav_count.toString()},t.tagTypes={Artist:e.tag_string_artist.split(" "),Copyright:e.tag_string_copyright.split(" "),Character:e.tag_string_character.split(" "),General:e.tag_string_general.split(" "),Meta:e.tag_string_meta.split(" ")},t.requiresVideoPlayer=e.large_file_url.endsWith(".webm")||e.large_file_url.endsWith(".mp4")||e.file_url.endsWith(".webm")||e.file_url.endsWith(".mp4"),t},t.prototype.rawSearch=function(e,t,r){var o=this;return new Promise((function(a,n){o.abortSearch();var i=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(t+1,"&limit=").concat(r,"&tags=").concat(e.join(" ")));o.activeSearchRequest=$.getJSON(i,(function(e){a({results:e,endOfResults:e.length<r})})).fail(n)}))},t.prototype.simpleSearch=function(e,t){var r=this;return new Promise((function(o,a){r.abortSearch();var n=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(t+1,"&limit=20&tags=").concat(e.join(" ")));r.activeSearchRequest=$.getJSON(n,(function(e){for(var t=[],a=0,n=e;a<n.length;a++){var i=n[a];try{var s=r.parsePost(i);s&&t.push(s)}catch(e){}}o({posts:t,endOfResults:e.length<20})})).fail(a)}))},t.prototype.analyseTags=function(e){for(var t=[],r=[],o=[],a=0,n=e;a<n.length;a++){var i=n[a];i.startsWith("-")?o.push(i.substring(1)):i.startsWith("rating:")?t.push(i):r.push(i)}return{untaxedTags:t,taxedTags:r,negatedTags:o}},t.prototype.search=function(e,t,r,o,a,c){return n(this,void 0,void 0,(function(){var n,l,u,h,d,f,g,m,y,b,v,w,S,$,P,T,x,_,R,C,O,k,A,I,q,j,E,M;return i(this,(function(i){switch(i.label){case 0:if(r&&!e.includes("rating:general")&&e.push("rating:general"),n=this.analyseTags(e),l=n.untaxedTags,u=n.taxedTags,h=n.negatedTags,!(u.length+h.length<3))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.simpleSearch(e,t)];case 2:return O=i.sent(),o(O.posts),a(t,O.endOfResults),[3,4];case 3:return d=i.sent(),c(d),[3,4];case 4:return[2];case 5:f=Array.from(new Set(s(s([],u,!0),h,!0))),i.label=6;case 6:return i.trys.push([6,8,,9]),[4,(0,p.getJsonPromise)("https://danbooru.donmai.us/tags.json?search[name_comma]=".concat(f.join(",")))];case 7:return g=i.sent(),[3,9];case 8:return m=i.sent(),c(m),[2];case 9:y=g.filter((function(e){return u.includes(e.name)})),b=g.filter((function(e){return h.includes(e.name)})),v=Array.from(y).sort((function(e,t){return e.post_count-t.post_count})).map((function(e){return e.name})),w=Array.from(b).sort((function(e,t){return t.post_count-e.post_count})).map((function(e){return e.name})),S=v.slice(0,2),$=w.slice(0,Math.max(0,2-S.length)),P=s(s(s([],S,!0),$.map((function(e){return"-"+e})),!0),l,!0),T=v.slice(S.length),x=w.slice($.length),_=0,R=0,C=0,i.label=10;case 10:i.label=11;case 11:return i.trys.push([11,14,,15]),[4,this.wait(250)];case 12:return i.sent(),[4,this.rawSearch(P,t+R,30)];case 13:for(O=i.sent(),k=[],A=function(e){var t=e.tag_string.split(" ");if(T.some((function(e){return!t.includes(e)})))return"continue";if(x.some((function(e){return t.includes(e)})))return"continue";try{var r=I.parsePost(e);r&&k.push(r)}catch(e){}},I=this,q=0,j=O.results;q<j.length;q++)E=j[q],A(E);return 0===k.length?C++:C=0,o(k),_+=k.length,C>=5||_>=20||O.endOfResults?(a(t+R,O.endOfResults),[2]):[3,15];case 14:return M=i.sent(),c(M),[2];case 15:return R++,[3,10];case 16:return[2]}}))}))},t.prototype.getPostByID=function(e,t){return n(this,void 0,void 0,(function(){var r,o;return i(this,(function(a){switch(a.label){case 0:return[4,e("https://danbooru.donmai.us/posts.json?tags=id:"+t)];case 1:if(r=a.sent(),!(o=r[0]))throw new Error("Post with ID '"+t+"' not found. Received: "+JSON.stringify(r,null,2));try{return[2,this.parsePost(o)]}catch(e){throw new Error("Could not parse returned JSON with error '"+e+"' and JSON: "+JSON.stringify(r,null,2))}return[2]}}))}))},t.prototype.generateEmbed=function(e){var t=new f.default("Danbooru #"+e.id,Object.values(e.tagTypes).join(" "));return t.url="https://danbooru.donmai.us/posts/"+e.id,t.imageUrl=e.getLargeImage(),t},t}(l.default);t.default=y},367:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(536),n=r(417),i=r(228),s={general:"General",sensitive:"Sensitive",questionable:"Questionable",explicit:"Explicit"},c={tag:a.default.General,artist:a.default.Artist,copyright:a.default.Copyright,character:a.default.Character,metadata:a.default.Meta},l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],u=n.SiteBuilder.buildSite({name:"Gelbooru",id:"gelbooru",isPorn:!1,proxyHeaders:{Referrer:"https://gelbooru.com/"},autocompleteModule:{url:(0,i.proxify)("json","https://gelbooru.com/index.php?page=autocomplete2&type=tag_query&limit=10&term={tag}"),transformer:function(e){return{label:"".concat(e.label," (").concat(e.post_count,")"),value:e.value,type:c[e.category]}}},searchUrl:(0,i.proxify)("json","https://gelbooru.com/index.php?page=dapi&s=post&q=index&json=1&limit=20&pid={page}&tags={tags}"),safeSearchTag:"rating:general",searchPreprocessor:function(e){return e.post||[]},searchTransformer:function(e){var t=new o.default(u);t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("gelbooru",e.file_url)],1==e.sample&&e.sample_url&&t.imageResolutions.splice(1,0,(0,i.proxify)("gelbooru",e.sample_url)),t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://gelbooru.com/index.php?page=post&s=view&id=".concat(e.id);var r=e.created_at.split(" "),a=l.indexOf(r[1])+1,n=r[2],c=r[5].padStart(4,"0")+"-"+String(a).padStart(2,"0")+"-"+n.padStart(2,"0");return t.properties={Rating:s[e.rating],Size:"".concat(e.width,"x").concat(e.height),Source:e.source,Date:c,Score:e.score.toString(),"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0]},t.tagTypes={Tags:e.tags.split(" ")},t.requiresVideoPlayer=e.sample_url.endsWith(".mp4")||e.sample_url.endsWith(".webm")||e.file_url.endsWith(".mp4")||e.file_url.endsWith(".webm"),t}});t.default=u},432:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(417),n=r(536),i=r(228),s={s:"Safe",q:"Questionable",e:"Explicit"},c=a.SiteBuilder.buildSite({name:"Konachan",id:"konachan",isPorn:!1,proxyHeaders:{Referrer:"https://konachan.com/"},autocompleteModule:{summaryUrl:(0,i.proxify)("json","https://konachan.com/tag/summary.json"),version:"1",typeToEnum:{0:n.default.General,1:n.default.Artist,3:n.default.Copyright,4:n.default.Character,5:n.default.Meta},delay:333},searchUrl:(0,i.proxify)("json","https://konachan.com/post.json?limit=20&page={page}&tags={tags}"),safeSearchTag:"rating:s",searchPageOffset:1,searchTransformer:function(e){var t=new o.default(c);return t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("konachan",e.sample_url),(0,i.proxify)("konachan",e.jpeg_url),(0,i.proxify)("konachan",e.file_url)],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://konachan.com/post/show/".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.width,"x").concat(e.height,")"),Source:""==e.source?"Unknown":e.source,Uploader:e.author,Date:new Date(1e3*e.created_at).toISOString().split("T")[0],Score:e.score.toString()},t.tagTypes={Tags:e.tags.split(" ")},t}});t.default=c},661:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(536),n=r(417),i=r(228),s={general:"General",sensitive:"Sensitive",questionable:"Questionable",explicit:"Explicit"},c=n.SiteBuilder.buildSite({name:"Rule 34",id:"rule34",isPorn:!0,proxyHeaders:{Referrer:"https://rule34.xxx/",Referer:"https://rule34.xxx/",Host:"rule34.xxx","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"},autocompleteModule:{url:(0,i.proxify)("rule34","https://rule34.xxx/public/autocomplete.php?q={tag}"),transformer:function(e){return{label:e.label,value:e.value,type:a.default.General}}},searchUrl:"https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&json=1&limit=20&&pid={page}&tags={tags}",searchTransformer:function(e){var t=new o.default(c);t.id=e.id.toString(),t.imageResolutions=[e.preview_url,e.file_url],e.sample&&e.sample_url&&t.imageResolutions.splice(1,0,e.sample_url);for(var r=0;r<t.imageResolutions.length;r++){var a=t.imageResolutions[r];if(a.includes("mp4")||a.includes("webm")){var n=new URL(a);t.imageResolutions[r]=(0,i.proxify)("rule34","https://ahri2mp4.rule34.xxx/"+n.pathname+"?"+t.id+"=")}}return t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://rule34.xxx/index.php?page=post&s=view&id=".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(e.width,"x").concat(e.height),Source:e.source,Uploader:e.owner||"Unknown",Score:e.score.toString(),"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0]},t.tagTypes={Tags:e.tags.split(" ")},t.requiresVideoPlayer=e.image.endsWith(".mp4")||e.image.endsWith(".webm"),t}});t.default=c},375:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(536),n=r(417),i=r(228),s=n.SiteBuilder.buildSite({name:"Safebooru",id:"safebooru",isPorn:!1,autocompleteModule:{url:(0,i.proxify)("json","https://safebooru.org/autocomplete.php?q={tag}"),transformer:function(e){return{label:e.label,value:e.value,type:a.default.General}}},searchUrl:(0,i.proxify)("json","https://safebooru.org/index.php?page=dapi&s=post&q=index&json=1&limit=20&&pid={page}&tags={tags}"),safeSearchTag:"rating:general",searchTransformer:function(e){var t,r,a=new o.default(s);return a.id=e.id.toString(),a.imageResolutions=["https://safebooru.org/thumbnails/".concat(e.directory,"/thumbnail_").concat(e.image),"https://safebooru.org/images/".concat(e.directory,"/").concat(e.image)],e.sample&&a.imageResolutions.splice(1,0,"https://safebooru.org/samples/".concat(e.directory,"/sample_").concat(e.image)),a.fullWidth=e.width,a.fullHeight=e.height,a.originalPost="https://safebooru.org/index.php?page=post&s=view&id=".concat(e.id),a.properties={"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0],Size:"".concat(e.width,"x").concat(e.height),Owner:e.owner||"Unknown",Rating:"General",Score:null!==(r=null===(t=e.score)||void 0===t?void 0:t.toString())&&void 0!==r?r:"0"},a.tagTypes={Tags:e.tags.split(" ")},a.requiresVideoPlayer=e.image.endsWith(".mp4")||e.image.endsWith(".webm"),a}});t.default=s},979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(417),n=r(536),i=r(228),s={s:"Safe",q:"Questionable",e:"Explicit"},c=a.SiteBuilder.buildSite({name:"Yande.re",id:"yandere",isPorn:!1,autocompleteModule:{summaryUrl:"https://yande.re/tag/summary.json",version:"1",typeToEnum:{0:n.default.General,1:n.default.Artist,3:n.default.Copyright,4:n.default.Character,5:n.default.Circle},delay:333},searchUrl:"https://yande.re/post.json?limit=20&page={page}&tags={tags}",safeSearchTag:"rating:s",searchPageOffset:1,searchTransformer:function(e){var t=new o.default(c);return t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("yandere",e.sample_url),(0,i.proxify)("yandere",e.jpeg_url),(0,i.proxify)("yandere",e.file_url)],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://yande.re/post/show/".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.width,"x").concat(e.height,")"),Source:""==e.source?"Unknown":e.source,Uploader:e.author,Date:new Date(e.created_at).toISOString().split("T")[0],"Last Updated":new Date(e.updated_at).toISOString().split("T")[0],Score:e.score.toString()},t.tagTypes={Tags:e.tags.split(" ")},t}});t.default=c},34:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var o=r(558),a=r(417),n=r(536),i=r(228),s={theme:n.default.General,game:n.default.Copyright,character:n.default.Character,mangaka:n.default.Artist,source:n.default.Meta,"Character Group":n.default.Character},c=a.SiteBuilder.buildSite({name:"Zerochan",id:"zerochan",isPorn:!1,proxyHeaders:{Referrer:"https://www.zerochan.net/"},autocompleteModule:{url:(0,i.proxify)("generic","https://www.zerochan.net/suggest?q={tag}&json=1&limit=10"),preprocessor:function(e){return e.suggestions},transformer:function(e){return{label:e.value,value:e.value,type:s[e.icon||e.type]||n.default.General}}},searchUrl:(0,i.proxify)("generic","https://www.zerochan.net/{tags}?l=20&p={page}&json"),searchPageOffset:1,searchTagDelimiter:",",searchPreprocessor:function(e){return e.items},searchTransformer:function(e){var t=new o.default(c);return t.id=e.id.toString(),t.imageResolutions=[e.thumbnail||e.small],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://www.zerochan.net/".concat(e.id),t.properties={Rating:"General",Source:""==e.source?"Unknown":e.source,Size:"".concat(e.width,"x").concat(e.height)},t.tagTypes={Tags:e.tags},$.getJSON((0,i.proxify)("generic","https://www.zerochan.net/".concat(e.id,"?json")),(function(e){t.imageResolutions.push(e.medium),t.imageResolutions.push(e.large),t.imageResolutions.push(e.full),t.properties.Size="".concat(Math.round(e.size/1e3)," KB (").concat(e.width,"x").concat(e.height,")")})),t}});t.default=c},536:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Artist="artist",e.Copyright="copyright",e.Character="character",e.General="general",e.Meta="meta",e.Circle="circle",e.Other="other"}(r||(r={})),t.default=r},228:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.proxify=t.getJsonPromise=void 0,t.getJsonPromise=function(e){return new Promise((function(t,r){$.getJSON(e,t).fail(r)}))},t.proxify=function(e,t){return"".concat("undefined"==typeof window?"":window.location.origin,"/proxy/").concat(e,"/").concat(t)}}},r={};function o(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}};return t[e].call(n.exports,n,n.exports,o),n.exports}e=o(139),(0,o(624).default)(),$(e.default.main.bind(e.default))})();
//# sourceMappingURL=bundle.js.map