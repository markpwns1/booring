(()=>{"use strict";var e={160:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,r){this.label=e,this.value=t,this.type=r}return e.decompose=function(e){var t="";return(e=e.trim()).startsWith("-")&&(t="-",e=e.substring(1).trim()),{negation:t,baseTag:e}},e}();t.default=r},729:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(228),i=r(160),s=r(536),u=function(){function e(){}return e.verifyCache=function(e,t,r){return n(this,void 0,void 0,(function(){var n,i,s,u;return a(this,(function(a){switch(a.label){case 0:if(!(localStorage.getItem(e.id+"-version")!=r||Date.now()-parseInt(localStorage.getItem(e.id+"-last-update")||"0")>6048e5))return[3,5];console.log("Fetching ".concat(e.name," tags from summary page: ").concat(t)),i=void 0,a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(0,o.getJsonPromise)(t)];case 2:return i=a.sent(),[3,4];case 3:throw s=a.sent(),u="Could not fetch ".concat(e.name," (").concat(e.id,") tags from summary page"),console.log(u),console.error(s),new Error(u);case 4:return localStorage.setItem(e.id+"-version",r),localStorage.setItem(e.id+"-last-update",Date.now().toString()),localStorage.setItem(e.id+"-tags",i.data),n=i.data,console.log("Updated ".concat(e.name," (").concat(e.id,") tag cache")),[3,6];case 5:console.log("Found ".concat(e.name," (").concat(e.id,") tag cache")),n=localStorage.getItem(e.id+"-tags"),a.label=6;case 6:return[2,n]}}))}))},e.complete=function(e,t,r){var n=i.default.decompose(e),a=n.negation,o=n.baseTag;if(0==o.length||""==t)return[];var u=this.createTagSearchRegex(o,{global:!0}),c=this.retrieveTagSearch(u,t,{max_results:100});c=(c=this.reorderSearchResults(o,c)).slice(0,10),-1!="sqe".indexOf(o)&&c.unshift("0`"+o+"` ");for(var l=[],p=0,h=c;p<h.length;p++){var f=h[p],d=f.match(/(\d+)`([^`]*)`(([^ ]*)`)? /);if(!d)return console.error("Unparsable cached tag: '"+f+"'"),[];var g=a+d[2];l.push(new i.default(g,g,r[d[1]]||s.default.Other))}return l},e.createTagSearchRegex=function(e,t){void 0===t&&(t={});var r=e.split(""),n=[],a="(([^`]*_)?";if(r.forEach((function(e){var t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a+=t})),a+=")",n.push(a),-1!==e.indexOf("_")){var o=e.split("_",1)[0],i=e.slice(o.length+1),s=o.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),u=i.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a="(",a+="("+s+"[^`]*_"+u+")",a+="|",a+="("+u+"[^`]*_"+s+")",a+=")",n.push(a)}!t.top_results_only&&r.length<12&&(a="(",r.forEach((function(e){var t=e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");a+=t,a+="[^`]*"})),a+=")",n.push(a));var c=n.join("|");return new RegExp("(\\d+)[^ ]*`("+c+")[^`]*`[^ ]* ","g")},e.retrieveTagSearch=function(e,t,r){void 0===r&&(r={});var n=[],a=10;for(void 0!==r.max_results&&(a=r.max_results);n.length<a;){var o=e.exec(t);if(!o)break;var i=o[0];-1===i.indexOf(":deletethistag:")&&-1===n.indexOf(i)&&n.push(i)}return n},e.reorderSearchResults=function(t,r){var n=e.createTagSearchRegex(t,{top_results_only:!0,global:!1}),a=[],o=[];return r.forEach((function(e){n.test(e)?a.push(e):o.push(e)})),a.concat(o)},e}();t.default=u},289:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.properties={},this.extra="",this.title=e,this.description=t}return e.prototype.build=function(){return"\n            \x3c!-- Primary Meta Tags --\x3e\n            <title>".concat(this.title,'</title>\n            <meta name="title" content="').concat(this.title,'" />\n            <meta name="description" content="').concat(this.description,'" />\n\n            \x3c!-- Open Graph / Facebook --\x3e\n            <meta property="og:type" content="website" />\n            ').concat(this.url?'<meta property="og:url" content="'.concat(this.url," />"):"",'\n            <meta property="og:title" content="').concat(this.title,'" />\n            <meta property="og:description" content="').concat(this.description,'" />\n            ').concat(this.imageUrl?'<meta property="og:image" content="'.concat(this.imageUrl,'" />'):"",'\n\n            \x3c!-- Twitter --\x3e\n            <meta property="twitter:card" content="summary_large_image" />\n            ').concat(this.url?'<meta property="twitter:url" content="'.concat(this.url," />"):"",'\n            <meta property="twitter:title" content="').concat(this.title,'" />\n            <meta property="twitter:description" content="').concat(this.description,'" />\n            ').concat(this.imageUrl?'<meta property="twitter:image" content="'.concat(this.imageUrl,'" />'):"",'\n\n            \x3c!-- Extra --\x3e\n            <meta name="twitter:card" content="summary_large_image" />\n            ').concat(this.extra,"\n        ")},e}();t.default=r},558:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.id="",this.requiresVideoPlayer=!1,this.imageResolutions=[],this.fullWidth=-1,this.fullHeight=-1,this.originalPost="",this.properties={},this.tagTypes={},this.site=e}return e.prototype.normalisedHeight=function(){return this.fullHeight/this.fullWidth},e.prototype.getThumbnail=function(){return this.imageResolutions[0]},e.prototype.getLargeImage=function(){return this.imageResolutions[1]||this.imageResolutions[0]},e.prototype.getFullSizeImage=function(){return this.imageResolutions[this.imageResolutions.length-1]},e}();t.default=r},417:function(e,t,r){var n,a=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__assign||function(){return o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},o.apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.SiteBuilder=void 0;var u=r(160),c=r(729),l=r(817);function p(e){return e}var h=function(){function e(){}return e.buildNetworkAutocomplete=function(t,r,n){void 0===n&&(n={}),n.delay=n.delay||0,n.minLength=n.minLength||1;var a=n.preprocessor||p;return n.delay>0?function(a,i,s,u){var c=e.buildNetworkAutocomplete(t,r,o(o({},n),{delay:0}));return setTimeout((function(){return c(a,i,s,u)}),n.delay)}:function(e,o,i,s){var c=u.default.decompose(e),l=c.negation,p=c.baseTag;if(p.length<(n.minLength||1))return o([]),i(),null;var h=encodeURI(t.replace("{tag}",p));return $.getJSON(h,(function(e){for(var t=[],n=0,s=a(e);n<s.length;n++){var u=s[n],c=r(u);c.label=l+c.label,c.value=l+c.value,t.push(c)}o(t),i()}))}},e.buildSearcher=function(e,t,r){return void 0===r&&(r={preprocessor:p,pageOffset:0,delimiter:" "}),function(n,a,o,i,s,u){r.safeSearchTag&&o&&(n=n.concat(r.safeSearchTag));var c=encodeURI(e.replace("{tags}",n.join(r.delimiter||" ")).replace("{page}",(a+(r.pageOffset||0)).toString()));return console.log("Searching... "+c),$.getJSON(c,(function(e){for(var n=[],o=0,u=r.preprocessor(e);o<u.length;o++){var c=u[o],l=t(c);l&&n.push(l)}console.log("Search successful"),i(n),s(a,n.length<20)})).fail(u)}},e.buildSite=function(t){if(t.autocompleteModule){if("url"in t.autocompleteModule){var r=t.autocompleteModule;return new(function(n){function o(){var a=n.call(this,t.name,t.id)||this;return a.isPorn=t.isPorn,a.autocompleteEnabled=!0,a.proxyHeaders=t.proxyHeaders||{},a.activeAutocompleteRequest=null,a.activeSearchRequest=null,a.parsePost=t.searchTransformer,a.autocompleter=e.buildNetworkAutocomplete(r.url,r.transformer,{minLength:r.minLength,delay:r.delay,preprocessor:r.preprocessor}),a.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||p,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),a}return a(o,n),o.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},o.prototype.autocomplete=function(e,t,r,n){this.abortAutocomplete(),this.activeAutocompleteRequest=this.autocompleter(e,t,r,n)||this.activeAutocompleteRequest},o.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},o.prototype.search=function(e,t,r,n,a,o){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,n,a,o)},o}(l.default))}if("summaryUrl"in t.autocompleteModule){var n=t.autocompleteModule;return new(function(r){function o(){var n=r.call(this,t.name,t.id)||this;return n.isPorn=t.isPorn,n.autocompleteEnabled=!1,n.proxyHeaders=t.proxyHeaders||{},n.tagCache="",n.activeAutocompleteRequest=null,n.activeSearchRequest=null,n.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||p,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),n}return a(o,r),o.prototype.onSelected=function(){return i(this,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return e=this,[4,c.default.verifyCache(this,n.summaryUrl,n.version)];case 1:return e.tagCache=t.sent()||"",this.autocompleteEnabled=!0,[2]}}))}))},o.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(clearTimeout(this.activeAutocompleteRequest),this.activeAutocompleteRequest=null)},o.prototype.autocomplete=function(e,r,a,o){var i,s=this;this.abortAutocomplete(),this.activeAutocompleteRequest=setTimeout((function(){r(c.default.complete(e,s.tagCache,n.typeToEnum)),a()}),(null===(i=t.autocompleteModule)||void 0===i?void 0:i.delay)||0)},o.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},o.prototype.search=function(e,t,r,n,a,o){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,n,a,o)},o}(l.default))}}return new(function(r){function n(){var n=r.call(this,t.name,t.id)||this;return n.isPorn=t.isPorn,n.autocompleteEnabled=!1,n.proxyHeaders=t.proxyHeaders||{},n.activeSearchRequest=null,n.searcher=e.buildSearcher(t.searchUrl,t.searchTransformer,{safeSearchTag:t.safeSearchTag,preprocessor:t.searchPreprocessor||p,pageOffset:t.searchPageOffset||0,delimiter:t.searchTagDelimiter||" "}),n}return a(n,r),n.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},n.prototype.search=function(e,t,r,n,a,o){this.abortSearch(),this.activeSearchRequest=this.searcher(e,t,r,n,a,o)},n}(l.default))},e.ExtractImagesGelboorulike=function(e){var t=[e.preview_url,e.file_url];return e.sample&&e.sample_url&&t.push(e.sample_url),t},e}();t.SiteBuilder=h},624:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(838),a=r(367),o=r(979),i=r(375),s=r(661),u=r(432),c=r(34),l=r(817);t.default=function(){l.default.register(new n.default),l.default.register(a.default),l.default.register(o.default),l.default.register(i.default),l.default.register(u.default),l.default.register(c.default),l.default.register(s.default)}},817:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.autocompleteEnabled=!1,this.isPorn=!1,this.proxyHeaders={},this.name=e,this.id=t}return e.find=function(t){return e.sites.find((function(e){return e.id===t}))},e.getAll=function(){return e.sites},e.register=function(t){e.sites.push(t),t.onRegistered()},e.prototype.onRegistered=function(){},e.prototype.onSelected=function(){},e.prototype.parsePost=function(e){throw new Error("parsePost not implemented")},e.prototype.autocomplete=function(e,t,r,n){n("Autocomplete not implemented")},e.prototype.abortAutocomplete=function(){},e.prototype.search=function(e,t,r,n,a,o){o("Search not implemented")},e.prototype.abortSearch=function(){},e.prototype.getPostByID=function(e,t){return new Promise((function(e,t){t("getPostByID not implemented")}))},e.prototype.generateEmbed=function(e){throw new Error("generateEmbed not implemented")},e.sites=[],e}();t.default=r},838:function(e,t,r){var n,a=this&&this.__extends||(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var u=r(558),c=r(817),l=r(160),p=r(536),h=r(228),f=r(417),d=r(289),g={g:"General",s:"Sensitive",q:"Questionable",e:"Explicit"},m={0:p.default.General,1:p.default.Artist,3:p.default.Copyright,4:p.default.Character,5:p.default.Meta},y=function(e){function t(){var r=e.call(this,"Danbooru","danbooru")||this;return r.autocompleteEnabled=!0,r.isPorn=!1,r.activeAutocompleteRequest=null,r.activeSearchRequest=null,r.autocompleter=f.SiteBuilder.buildNetworkAutocomplete("https://danbooru.donmai.us/autocomplete.json?only=name,post_count,category&limit=10&search[type]=tag_query&search[query]={tag}",t.autocompleteTransformFunction,{minLength:3}),r}return a(t,e),t.prototype.wait=function(e){return new Promise((function(t){return setTimeout(t,e)}))},t.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},t.autocompleteTransformFunction=function(e){return new l.default(e.post_count?"".concat(e.label," (").concat(e.post_count,")"):e.label,e.value,m[e.category]||p.default.Other)},t.prototype.autocomplete=function(e,t,r,n){this.abortAutocomplete(),this.activeSearchRequest=this.autocompleter(e,t,r,n)||this.activeSearchRequest},t.prototype.abortSearch=function(){this.activeSearchRequest&&this.activeSearchRequest.abort()},t.prototype.parsePost=function(e){if(!e.preview_file_url&&!e.large_file_url&&!e.file_url)throw new Error("Post does not contain any image");var t=new u.default(this);return t.id=e.id.toString(),t.imageResolutions=[e.preview_file_url,e.large_file_url,e.file_url],t.fullWidth=e.image_width,t.fullHeight=e.image_height,t.originalPost="https://danbooru.donmai.us/posts/".concat(e.id),t.properties={Rating:g[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.image_width,"x").concat(e.image_height,")"),Source:e.source,Date:e.created_at.split("T")[0],Score:e.score.toString(),Favourites:e.fav_count.toString()},t.tagTypes={Artist:e.tag_string_artist.split(" "),Copyright:e.tag_string_copyright.split(" "),Character:e.tag_string_character.split(" "),General:e.tag_string_general.split(" "),Meta:e.tag_string_meta.split(" ")},t.requiresVideoPlayer=e.large_file_url.endsWith(".webm")||e.large_file_url.endsWith(".mp4")||e.file_url.endsWith(".webm")||e.file_url.endsWith(".mp4"),t},t.prototype.rawSearch=function(e,t,r){var n=this;return new Promise((function(a,o){n.abortSearch();var i=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(t+1,"&limit=").concat(r,"&tags=").concat(e.join(" ")));n.activeSearchRequest=$.getJSON(i,(function(e){a({results:e,endOfResults:e.length<r})})).fail(o)}))},t.prototype.simpleSearch=function(e,t){var r=this;return new Promise((function(n,a){r.abortSearch();var o=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(t+1,"&limit=20&tags=").concat(e.join(" ")));r.activeSearchRequest=$.getJSON(o,(function(e){for(var t=[],a=0,o=e;a<o.length;a++){var i=o[a];try{var s=r.parsePost(i);s&&t.push(s)}catch(e){}}n({posts:t,endOfResults:e.length<20})})).fail(a)}))},t.prototype.analyseTags=function(e){for(var t=[],r=[],n=[],a=0,o=e;a<o.length;a++){var i=o[a];i.startsWith("-")?n.push(i.substring(1)):i.startsWith("rating:")?t.push(i):r.push(i)}return{untaxedTags:t,taxedTags:r,negatedTags:n}},t.prototype.search=function(e,t,r,n,a,u){return o(this,void 0,void 0,(function(){var o,c,l,p,f,d,g,m,y,v,b,w,_,S,x,R,P,T,O,q,j,A,M,E,U,k,C,I;return i(this,(function(i){switch(i.label){case 0:if(r&&!e.includes("rating:general")&&e.push("rating:general"),o=this.analyseTags(e),c=o.untaxedTags,l=o.taxedTags,p=o.negatedTags,!(l.length+p.length<3))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.simpleSearch(e,t)];case 2:return j=i.sent(),n(j.posts),a(t,j.endOfResults),[3,4];case 3:return f=i.sent(),u(f),[3,4];case 4:return[2];case 5:d=Array.from(new Set(s(s([],l,!0),p,!0))),i.label=6;case 6:return i.trys.push([6,8,,9]),[4,(0,h.getJsonPromise)("https://danbooru.donmai.us/tags.json?search[name_comma]=".concat(d.join(",")))];case 7:return g=i.sent(),[3,9];case 8:return m=i.sent(),u(m),[2];case 9:y=g.filter((function(e){return l.includes(e.name)})),v=g.filter((function(e){return p.includes(e.name)})),b=Array.from(y).sort((function(e,t){return e.post_count-t.post_count})).map((function(e){return e.name})),w=Array.from(v).sort((function(e,t){return t.post_count-e.post_count})).map((function(e){return e.name})),_=b.slice(0,2),S=w.slice(0,Math.max(0,2-_.length)),x=s(s(s([],_,!0),S.map((function(e){return"-"+e})),!0),c,!0),R=b.slice(_.length),P=w.slice(S.length),T=0,O=0,q=0,i.label=10;case 10:i.label=11;case 11:return i.trys.push([11,14,,15]),[4,this.wait(250)];case 12:return i.sent(),[4,this.rawSearch(x,t+O,30)];case 13:for(j=i.sent(),A=[],M=function(e){var t=e.tag_string.split(" ");if(R.some((function(e){return!t.includes(e)})))return"continue";if(P.some((function(e){return t.includes(e)})))return"continue";try{var r=E.parsePost(e);r&&A.push(r)}catch(e){}},E=this,U=0,k=j.results;U<k.length;U++)C=k[U],M(C);return 0===A.length?q++:q=0,n(A),T+=A.length,q>=5||T>=20||j.endOfResults?(a(t+O,j.endOfResults),[2]):[3,15];case 14:return I=i.sent(),u(I),[2];case 15:return O++,[3,10];case 16:return[2]}}))}))},t.prototype.getPostByID=function(e,t){return o(this,void 0,void 0,(function(){var r,n;return i(this,(function(a){switch(a.label){case 0:return[4,e("https://danbooru.donmai.us/posts.json?tags=id:"+t)];case 1:if(r=a.sent(),!(n=r[0]))throw new Error("Post with ID '"+t+"' not found. Received: "+JSON.stringify(r,null,2));try{return[2,this.parsePost(n)]}catch(e){throw new Error("Could not parse returned JSON with error '"+e+"' and JSON: "+JSON.stringify(r,null,2))}return[2]}}))}))},t.prototype.generateEmbed=function(e){var t=new d.default("Danbooru #"+e.id,Object.values(e.tagTypes).join(" "));return t.url="https://danbooru.donmai.us/posts/"+e.id,t.imageUrl=e.getLargeImage(),t},t}(c.default);t.default=y},367:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(536),o=r(417),i=r(228),s={general:"General",sensitive:"Sensitive",questionable:"Questionable",explicit:"Explicit"},u={tag:a.default.General,artist:a.default.Artist,copyright:a.default.Copyright,character:a.default.Character,metadata:a.default.Meta},c=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],l=o.SiteBuilder.buildSite({name:"Gelbooru",id:"gelbooru",isPorn:!1,proxyHeaders:{Referrer:"https://gelbooru.com/"},autocompleteModule:{url:(0,i.proxify)("json","https://gelbooru.com/index.php?page=autocomplete2&type=tag_query&limit=10&term={tag}"),transformer:function(e){return{label:"".concat(e.label," (").concat(e.post_count,")"),value:e.value,type:u[e.category]}}},searchUrl:(0,i.proxify)("json","https://gelbooru.com/index.php?page=dapi&s=post&q=index&json=1&limit=20&pid={page}&tags={tags}"),safeSearchTag:"rating:general",searchPreprocessor:function(e){return e.post||[]},searchTransformer:function(e){var t=new n.default(l);t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("gelbooru",e.file_url)],1==e.sample&&e.sample_url&&t.imageResolutions.splice(1,0,(0,i.proxify)("gelbooru",e.sample_url)),t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://gelbooru.com/index.php?page=post&s=view&id=".concat(e.id);var r=e.created_at.split(" "),a=c.indexOf(r[1])+1,o=r[2],u=r[5].padStart(4,"0")+"-"+String(a).padStart(2,"0")+"-"+o.padStart(2,"0");return t.properties={Rating:s[e.rating],Size:"".concat(e.width,"x").concat(e.height),Source:e.source,Date:u,Score:e.score.toString(),"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0]},t.tagTypes={Tags:e.tags.split(" ")},t.requiresVideoPlayer=e.sample_url.endsWith(".mp4")||e.sample_url.endsWith(".webm")||e.file_url.endsWith(".mp4")||e.file_url.endsWith(".webm"),t}});t.default=l},432:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(417),o=r(536),i=r(228),s={s:"Safe",q:"Questionable",e:"Explicit"},u=a.SiteBuilder.buildSite({name:"Konachan",id:"konachan",isPorn:!1,proxyHeaders:{Referrer:"https://konachan.com/"},autocompleteModule:{summaryUrl:(0,i.proxify)("json","https://konachan.com/tag/summary.json"),version:"1",typeToEnum:{0:o.default.General,1:o.default.Artist,3:o.default.Copyright,4:o.default.Character,5:o.default.Meta},delay:333},searchUrl:(0,i.proxify)("json","https://konachan.com/post.json?limit=20&page={page}&tags={tags}"),safeSearchTag:"rating:s",searchPageOffset:1,searchTransformer:function(e){var t=new n.default(u);return t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("konachan",e.sample_url),(0,i.proxify)("konachan",e.jpeg_url),(0,i.proxify)("konachan",e.file_url)],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://konachan.com/post/show/".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.width,"x").concat(e.height,")"),Source:""==e.source?"Unknown":e.source,Uploader:e.author,Date:new Date(1e3*e.created_at).toISOString().split("T")[0],Score:e.score.toString()},t.tagTypes={Tags:e.tags.split(" ")},t}});t.default=u},661:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(536),o=r(417),i=r(228),s={general:"General",sensitive:"Sensitive",questionable:"Questionable",explicit:"Explicit"},u=o.SiteBuilder.buildSite({name:"Rule 34",id:"rule34",isPorn:!0,proxyHeaders:{Referrer:"https://rule34.xxx/",Referer:"https://rule34.xxx/",Host:"rule34.xxx","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:121.0) Gecko/20100101 Firefox/121.0"},autocompleteModule:{url:(0,i.proxify)("rule34","https://rule34.xxx/public/autocomplete.php?q={tag}"),transformer:function(e){return{label:e.label,value:e.value,type:a.default.General}}},searchUrl:"https://api.rule34.xxx/index.php?page=dapi&s=post&q=index&json=1&limit=20&&pid={page}&tags={tags}",searchTransformer:function(e){var t=new n.default(u);t.id=e.id.toString(),t.imageResolutions=[e.preview_url,e.file_url],e.sample&&e.sample_url&&t.imageResolutions.splice(1,0,e.sample_url);for(var r=0;r<t.imageResolutions.length;r++){var a=t.imageResolutions[r];if(a.includes("mp4")||a.includes("webm")){var o=new URL(a);t.imageResolutions[r]=(0,i.proxify)("rule34","https://ahri2mp4.rule34.xxx/"+o.pathname+"?"+t.id+"=")}}return t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://rule34.xxx/index.php?page=post&s=view&id=".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(e.width,"x").concat(e.height),Source:e.source,Uploader:e.owner||"Unknown",Score:e.score.toString(),"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0]},t.tagTypes={Tags:e.tags.split(" ")},t.requiresVideoPlayer=e.image.endsWith(".mp4")||e.image.endsWith(".webm"),t}});t.default=u},375:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(536),o=r(417),i=r(228),s=o.SiteBuilder.buildSite({name:"Safebooru",id:"safebooru",isPorn:!1,autocompleteModule:{url:(0,i.proxify)("json","https://safebooru.org/autocomplete.php?q={tag}"),transformer:function(e){return{label:e.label,value:e.value,type:a.default.General}}},searchUrl:(0,i.proxify)("json","https://safebooru.org/index.php?page=dapi&s=post&q=index&json=1&limit=20&&pid={page}&tags={tags}"),safeSearchTag:"rating:general",searchTransformer:function(e){var t,r,a=new n.default(s);return a.id=e.id.toString(),a.imageResolutions=["https://safebooru.org/thumbnails/".concat(e.directory,"/thumbnail_").concat(e.image),"https://safebooru.org/images/".concat(e.directory,"/").concat(e.image)],e.sample&&a.imageResolutions.splice(1,0,"https://safebooru.org/samples/".concat(e.directory,"/sample_").concat(e.image)),a.fullWidth=e.width,a.fullHeight=e.height,a.originalPost="https://safebooru.org/index.php?page=post&s=view&id=".concat(e.id),a.properties={"Last Updated":new Date(1e3*e.change).toISOString().split("T")[0],Size:"".concat(e.width,"x").concat(e.height),Owner:e.owner||"Unknown",Rating:"General",Score:null!==(r=null===(t=e.score)||void 0===t?void 0:t.toString())&&void 0!==r?r:"0"},a.tagTypes={Tags:e.tags.split(" ")},a.requiresVideoPlayer=e.image.endsWith(".mp4")||e.image.endsWith(".webm"),a}});t.default=s},979:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(417),o=r(536),i=r(228),s={s:"Safe",q:"Questionable",e:"Explicit"},u=a.SiteBuilder.buildSite({name:"Yande.re",id:"yandere",isPorn:!1,autocompleteModule:{summaryUrl:"https://yande.re/tag/summary.json",version:"1",typeToEnum:{0:o.default.General,1:o.default.Artist,3:o.default.Copyright,4:o.default.Character,5:o.default.Circle},delay:333},searchUrl:"https://yande.re/post.json?limit=20&page={page}&tags={tags}",safeSearchTag:"rating:s",searchPageOffset:1,searchTransformer:function(e){var t=new n.default(u);return t.id=e.id.toString(),t.imageResolutions=[e.preview_url,(0,i.proxify)("yandere",e.sample_url),(0,i.proxify)("yandere",e.jpeg_url),(0,i.proxify)("yandere",e.file_url)],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://yande.re/post/show/".concat(e.id),t.properties={Rating:s[e.rating],Size:"".concat(Math.round(e.file_size/1e3)," KB (").concat(e.width,"x").concat(e.height,")"),Source:""==e.source?"Unknown":e.source,Uploader:e.author,Date:new Date(e.created_at).toISOString().split("T")[0],"Last Updated":new Date(e.updated_at).toISOString().split("T")[0],Score:e.score.toString()},t.tagTypes={Tags:e.tags.split(" ")},t}});t.default=u},34:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});var n=r(558),a=r(417),o=r(536),i=r(228),s={theme:o.default.General,game:o.default.Copyright,character:o.default.Character,mangaka:o.default.Artist,source:o.default.Meta,"Character Group":o.default.Character},u=a.SiteBuilder.buildSite({name:"Zerochan",id:"zerochan",isPorn:!1,proxyHeaders:{Referrer:"https://www.zerochan.net/"},autocompleteModule:{url:(0,i.proxify)("generic","https://www.zerochan.net/suggest?q={tag}&json=1&limit=10"),preprocessor:function(e){return e.suggestions},transformer:function(e){return{label:e.value,value:e.value,type:s[e.icon||e.type]||o.default.General}}},searchUrl:(0,i.proxify)("generic","https://www.zerochan.net/{tags}?l=20&p={page}&json"),searchPageOffset:1,searchTagDelimiter:",",searchPreprocessor:function(e){return e.items},searchTransformer:function(e){var t=new n.default(u);return t.id=e.id.toString(),t.imageResolutions=[e.thumbnail||e.small],t.fullWidth=e.width,t.fullHeight=e.height,t.originalPost="https://www.zerochan.net/".concat(e.id),t.properties={Rating:"General",Source:""==e.source?"Unknown":e.source,Size:"".concat(e.width,"x").concat(e.height)},t.tagTypes={Tags:e.tags},$.getJSON((0,i.proxify)("generic","https://www.zerochan.net/".concat(e.id,"?json")),(function(e){t.imageResolutions.push(e.medium),t.imageResolutions.push(e.large),t.imageResolutions.push(e.full),t.properties.Size="".concat(Math.round(e.size/1e3)," KB (").concat(e.width,"x").concat(e.height,")")})),t}});t.default=u},536:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.Artist="artist",e.Copyright="copyright",e.Character="character",e.General="general",e.Meta="meta",e.Circle="circle",e.Other="other"}(r||(r={})),t.default=r},228:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.proxify=t.getJsonPromise=void 0,t.getJsonPromise=function(e){return new Promise((function(t,r){$.getJSON(e,t).fail(r)}))},t.proxify=function(e,t){return"".concat("undefined"==typeof window?"":window.location.origin,"/proxy/").concat(e,"/").concat(t)}},557:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,o){function i(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}u((n=n.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(860),i=r(167),s=r(687),u=r(147),c=r(809),l=r(245),p=r(624),h=r(817),f=o(),d=process.env.PORT||3e3,g=u.readFileSync(__dirname+"/resources/redirect.html","utf-8"),m=[],y=new s.Agent({rejectUnauthorized:!1});function v(e,t){console.log("".concat(l().format("YYYY-MM-DD hh:mm:ss")," [").concat(e,"] ").concat(t))}f.use(o.static(__dirname+"/public")),f.use((function(e,t,r){v("request",e.url),r()})),f.get("/",(function(e,t){t.sendFile(__dirname+"/resources/index.html")})),f.get("/proxy/json/*",(function(e,t){var r=e.url.substring(12);(0,c.default)(r).then((function(e){return e.json()})).then((function(e){return t.json(e)})).catch((function(e){t.sendStatus(500),v("error",e)}))})),f.get("/proxy/:site/*",(function(e,t){var r={};if("generic"!=e.params.site){var n=h.default.find(e.params.site||"");n&&(r=n.proxyHeaders)}var a=8+e.params.site.length;!function(e,t,r){i.default.get(e,{responseType:"stream",headers:r,httpsAgent:y}).then((function(e){t.writeHead(e.status,e.headers),e.data.pipe(t)})).catch((function(e){t.sendStatus(500),v("error",e)}))}(e.url.substring(a),t,r)})),f.get("/post/:domain/:id",(function(e,t){return n(void 0,void 0,void 0,(function(){function r(e){return(0,c.default)(e,{headers:n.proxyHeaders}).then((function(e){return e.json()}))}var n,o,i,s,u;return a(this,(function(a){switch(a.label){case 0:if("undefined"==e.params.id)return[2];if(!(n=h.default.find(e.params.domain||"")))return t.sendStatus(500),[2];o=n.name+" #"+e.params.id,i="\n    <title>".concat(o,'</title>\n    <meta name="title" content="').concat(o,'" />'),a.label=1;case 1:return a.trys.push([1,4,,5]),(s=m.find((function(t){return t.id==e.params.id&&t.site==n})))?[3,3]:[4,n.getPostByID(r,e.params.id)];case 2:s=a.sent(),m.push(s),m.length>100&&m.shift(),a.label=3;case 3:return u=n.generateEmbed(s),i=u.build(),[3,5];case 4:return a.sent(),[3,5];case 5:return t.send(function(e,t){for(var r in t)for(var n="["+r+"]";e.includes(n);)e=e.replace(n,t[r]);return e}(g,{META_PROPERTIES:i,REDIRECT_URL:"/?domain="+n.id+"&tags=id:"+((null==s?void 0:s.id)||e.params.id)})),[2]}}))}))})),f.listen(d,(function(){v("info","Booring server listening on port ".concat(d,"!")),(0,p.default)(),v("info","Registered all sites.")}))},167:e=>{e.exports=require("axios")},860:e=>{e.exports=require("express")},245:e=>{e.exports=require("moment")},809:e=>{e.exports=require("node-fetch")},147:e=>{e.exports=require("fs")},687:e=>{e.exports=require("https")}},t={};!function r(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}(557)})();
//# sourceMappingURL=server.bundle.js.map