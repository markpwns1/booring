(()=>{"use strict";var t,e={710:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){}return t.decompose=function(t){var e="";return(t=t.trim()).startsWith("-")&&(e="-",t=t.substring(1).trim()),{negation:e,baseTag:t}},t}();e.default=o},263:function(t,e,o){var n=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(r,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},a=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var n,r=0,a=e.length;r<a;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var i=o(431),s=function(){function t(){}return t.onHeaderSearchClick=function(t){t.stopPropagation(),this.searchViewOpen?this.hideSearchView():this.showSearchView()},t.closeSearchByClick=function(t){this.searchViewOpen&&!this.$viewSearch[0].contains(t.target)&&(this.$viewSearch.hide(),this.searchViewOpen=!1,t.preventDefault())},t.onSearchInputKeyDown=function(t){if("Enter"===t.key){if(""===this.$searchInput.val())return void this.search();if(this.selectedAutocompleteTag>-1)(o=this.$autocompleteTags.children()).eq(this.selectedAutocompleteTag).trigger("click");else{this.suppressAutocomplete=!0;var e=this.$searchInput.val();this.addSearchTag(e),this.$searchInput.val(""),this.$autocompleteTags.empty(),this.$autocompleteTags.hide()}}else if("ArrowDown"==t.key){t.preventDefault(),this.selectedAutocompleteTag++;var o=this.$autocompleteTags.children();this.selectedAutocompleteTag>=o.length&&(this.selectedAutocompleteTag=0),this.selectAutocompleteTag(this.selectedAutocompleteTag)}else"ArrowUp"==t.key?(t.preventDefault(),this.selectedAutocompleteTag--,this.selectedAutocompleteTag<0&&(this.selectedAutocompleteTag=this.$autocompleteTags.children().length-1),this.selectAutocompleteTag(this.selectedAutocompleteTag)):"Escape"==t.key&&(this.selectedAutocompleteTag>-1?this.unselectAutocompleteTags():this.hideSearchView())},t.onSearchInputChange=function(){var t=this;this.suppressAutocomplete?this.suppressAutocomplete=!1:i.default.current.autocompleteEnabled?i.default.current.autocomplete(this.$searchInput.val(),(function(e){t.updateAutocompleteTags(e)}),(function(){}),(function(t){console.error(t)})):this.$autocompleteTags.hide()},t.onSearchCancelClick=function(t){t.stopPropagation(),this.$resultsFooterText.text("Currently showing "+this.posts.length+' images.\n\nNote that due to technical limitations, if you click "Show more...", you will get some repeat posts.'),this.$btnFooterSearch.hide(),this.$btnLoadMore.show(),this.$btnCancelSearch.hide(),i.default.current.abortSearch()},t.onNextPostClick=function(t){var e=this;null==t||t.stopPropagation(),this.currentPost<this.posts.length-1&&this.openPost(this.posts[++this.currentPost],(function(){e.currentPost<e.posts.length-1&&e.preloadImage(e.posts[e.currentPost+1].getLargeImage(),(function(t){e.cachedImage=t}))})),this.$btnNextPost.trigger("blur")},t.onPrevPostClick=function(t){var e=this;null==t||t.stopPropagation(),this.currentPost>0&&this.openPost(this.posts[--this.currentPost],(function(){e.currentPost>0&&e.preloadImage(e.posts[e.currentPost-1].getLargeImage(),(function(t){e.cachedImage=t}))})),this.$btnPrevPost.trigger("blur")},t.onWindowKeyDown=function(t){this.openedPost&&("ArrowRight"===t.key?this.onNextPostClick():"ArrowLeft"===t.key&&this.onPrevPostClick())},t.onCopyButtonPressed=function(t){var e=this;t.stopPropagation();var o="".concat(window.location.origin,"/post/").concat(this.openedPost.site.id,"/").concat(this.openedPost.id),n=document.createElement("textarea");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="2em",n.style.height="2em",n.style.padding="0",n.style.border="none",n.style.outline="none",n.style.boxShadow="none",n.style.background="transparent",n.value=o,document.body.appendChild(n),n.focus(),n.select();try{var r=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+r)}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(n),this.$btnCopyLink.text("Copied!"),setTimeout((function(){e.$btnCopyLink.text("Copy link")}),2e3),this.$btnCopyLink.trigger("blur")},t.onDownloadButtonPressed=function(t){t.stopPropagation();var e=window.location.origin+"/download/"+this.openedPost.getFullSizeImage(),o=e.split(".").pop(),n="".concat(this.openedPost.site.id,"-").concat(this.openedPost.id,".").concat(o),r=document.createElement("a");r.href=e,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),this.$btnDownload.trigger("blur")},t.onClosePostClick=function(t){t.stopPropagation(),this.$postPlaceholder.show(),this.$post.hide(),this.$postVideo.trigger("pause"),this.$postVideo.attr("src",""),this.$postVideo.attr("poster",""),this.$postImage.attr("src",""),this.$postDownscaleWarning.hide(),window.innerWidth<1e3&&(this.$paneLeft.show(),this.$paneRight.hide()),this.openedPost=void 0},t.onWindowResize=function(){!this.openedPost&&window.innerWidth<1e3&&this.$paneRight.hide()},t.arraySetEquals=function(t,e){if(void 0===t||void 0===e)return!1;if(t===e)return!0;if(t.length!==e.length)return!1;for(var o=0,n=t;o<n.length;o++){var r=n[o];if(!e.includes(r))return!1}for(var a=0,i=e;a<i.length;a++)if(r=i[a],!t.includes(r))return!1;return!0},t.preloadImage=function(t,e){var o=new Image;o.onload=e.bind(this,o),o.src=t},t.search=function(t){var e=this;void 0===t&&(t=!1),!t&&this.lastSearch&&i.default.current==this.lastSearch.site&&this.arraySetEquals(this.searchTags,this.lastSearch.tags)&&this.currentPage==this.lastSearch.page?console.log("Same search. Cancelling."):(console.log("Searching: "+this.searchTags.join(", ")),t||(this.currentPage=0),this.$resultsPlaceholder.hide(),this.$results.show(),this.$resultsFooter.show(),this.$resultsFooterText.text("Loading..."),this.$btnFooterSearch.hide(),this.$btnLoadMore.hide(),this.$btnCancelSearch.show(),t||this.clearResults(),this.lastSearch={tags:a([],this.searchTags,!0),page:this.currentPage,site:i.default.current},i.default.current.search(this.searchTags,this.currentPage,(function(t){return n(e,void 0,void 0,(function(){return r(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map(this.addPost.bind(this)))];case 1:return e.sent(),[2]}}))}))}),(function(t,o){e.currentPage=t,o?(e.$resultsFooterText.text("No more images found."),e.$btnFooterSearch.show(),e.$btnLoadMore.hide(),e.$btnCancelSearch.hide()):(e.$resultsFooterText.text(""),e.$btnFooterSearch.hide(),e.$btnLoadMore.show(),e.$btnCancelSearch.hide())}),(function(t){return console.error(t)})),this.hideSearchView())},t.clearResults=function(){this.$resultsLeftColumn.empty(),this.$resultsRightColumn.empty(),this.leftColumnHeight=0,this.rightColumnHeight=0,this.posts=[]},t.addPost=function(t){var e=this;return new Promise((function(o,n){var r=new Image;r.onload=function(){e.leftColumnHeight<e.rightColumnHeight?(e.$resultsLeftColumn.append(r),e.leftColumnHeight+=t.normalisedHeight()):(e.$resultsRightColumn.append(r),e.rightColumnHeight+=t.normalisedHeight()),e.posts.push(t),o()},r.onclick=function(o){o.stopPropagation(),e.openPost(t)},r.onerror=n,r.src=t.getThumbnail(),r.className="results-image"}))},t.unselectAutocompleteTags=function(){this.selectedAutocompleteTag=-1,this.$autocompleteTags.children().removeClass("selected")},t.selectAutocompleteTag=function(t){if(this.selectedAutocompleteTag=t,!(this.selectedAutocompleteTag<0)){var e=this.$autocompleteTags.children();this.selectedAutocompleteTag>=e.length||(e.removeClass("selected"),e.eq(this.selectedAutocompleteTag).addClass("selected"))}},t.updateAutocompleteTags=function(t){var e=this;if(this.unselectAutocompleteTags(),0!=t.length){this.$autocompleteTags.show(),this.$autocompleteTags.empty();for(var o=function(t){var o=$('<button class="autocomplete-tag tag-'.concat(t.type,'">').concat(t.label,"</button>"));o.on("click touchstart",(function(o){e.suppressAutocomplete=!0,o.stopPropagation(),o.preventDefault(),e.addSearchTag(t.value),e.$searchInput.val(""),e.$autocompleteTags.empty(),e.$autocompleteTags.hide()})),n.$autocompleteTags.append(o)},n=this,r=0,a=t;r<a.length;r++)o(a[r])}else this.$autocompleteTags.hide()},t.showSearchView=function(){this.$viewSearch.show(),this.searchViewOpen=!0,this.$searchInput.trigger("focus")},t.hideSearchView=function(){this.$viewSearch.hide(),this.searchViewOpen=!1,this.$searchInput.val(""),this.$autocompleteTags.hide(),this.$autocompleteTags.empty(),this.unselectAutocompleteTags()},t.addSearchTag=function(t){var e=this;if(t=t.trim(),!this.searchTags.includes(t)){this.searchTags.push(t);var o=$('<span class="search-tag">'.concat(t,' <span class="search-tag-close">&#x2715</span></span>'));o.one("click",(function(n){n.stopPropagation(),e.searchTags.splice(e.searchTags.indexOf(t),1),o.remove(),0===e.searchTags.length&&(e.$searchTagDisplay.hide(),e.$searchTagHeaderNoTags.show())})),this.$searchTagHeaderNoTags.hide(),this.$searchCurrentTags.append(o),this.$searchTagDisplay.show()}},t.clearSearchTags=function(){this.searchTags=[],this.$searchCurrentTags.empty(),this.$searchTagDisplay.hide(),this.$searchTagHeaderNoTags.show()},t.openPost=function(t,e){var o=this;if(!this.openedPost||this.openedPost.id!==t.id){if(window.innerWidth<1e3?this.$paneLeft.hide():this.$paneLeft.show(),this.$postPlaceholder.hide(),this.$post.show(),this.$paneRight.show(),this.currentPost=this.posts.indexOf(t),console.log("Opening post "+this.currentPost),this.$postPlaceholder.hide(),this.$post.show(),t.requiresVideoPlayer)this.$postImage.hide(),this.$postVideo.show(),this.$postVideo.attr("poster",t.getThumbnail()),this.$postVideo.attr("src",t.getLargeImage()),this.$postVideo.trigger("play");else{this.$postVideo.hide(),this.$postImage.show();var n=this.cachedImage&&this.cachedImage.src===t.getLargeImage()?1:0;this.$postImage.attr("src",t.imageResolutions[n]);var r=this.$postImage[0];r.onload=function(){n>0&&e&&e();var a=Math.round(r.height/r.naturalHeight*100),i=Math.round(r.naturalHeight/t.fullHeight*100);r.naturalHeight<r.height&&a>175&&n<t.imageResolutions.length-1&&(n++,o.$postImage.attr("src",t.imageResolutions[n])),i<100?(o.$postDownscaleWarning.show(),o.$postDownscaleWarning.text("Resized to ".concat(i,"% of original"))):o.$postDownscaleWarning.hide()},r.onerror=function(){o.$postImage.attr("src",t.getThumbnail())}}if(this.$postInfoHeader.text("".concat(t.site.name," #").concat(t.id)),this.openedPost&&this.openedPost.site===t.site){for(var a in t.properties)this.postProperties[a].html("<b>".concat(a,"</b>: ").concat(t.properties[a]));for(var a in t.tagTypes)this.postTagTypes[a].text(t.tagTypes[a].join(" "))}else{for(var a in this.$postInfo.empty(),t.properties)if(t.properties[a]){var i=$('<span class="post-property"><b>'.concat(a,"</b>: ").concat(t.properties[a],"</span>"));this.postProperties[a]=i,this.$postInfo.append(i)}for(var a in this.$postTagTypes.empty(),t.tagTypes){var s=t.tagTypes[a];if(s&&0!=s.length){var c=$('<div class="post-tag-type"></div>'),l=$('<h3 class="post-tag-type-header"><b>'.concat(a,"</b></h3>"));c.append(l);var u=$('<span class="post-tag-list tag-'.concat(a.toLowerCase(),'">').concat(s.join(" "),"</span>"));c.append(u),this.postTagTypes[a]=u,this.$postTagTypes.append(c)}}}0===this.currentPost?this.$btnPrevPost.addClass("invisible"):this.$btnPrevPost.removeClass("invisible"),this.currentPost===this.posts.length-1?this.$btnNextPost.addClass("invisible"):this.$btnNextPost.removeClass("invisible"),this.openedPost=t}},t.main=function(){var t=this;this.$btnHeaderSearch=$("#header-search, #results-placeholder, #btn-different-search"),this.$viewSearch=$("#view-search"),this.$viewSearch.hide(),this.$searchInput=$("#search-input"),this.$searchCurrentTags=$("#search-current-tags"),this.$searchTagHeaderNoTags=$("#search-tag-header-no-tags"),this.$searchTagDisplay=$("#search-tag-display"),this.$searchTagDisplay.hide(),this.$btnClearTags=$("#btn-clear"),this.$btnExitSearch=$("#btn-exit-search"),this.$selectSearchSite=$("#search-site"),this.$btnSearch=$("#btn-search"),this.$resultsLeftColumn=$("#results-column-left"),this.$resultsRightColumn=$("#results-column-right"),this.$resultsPlaceholder=$("#results-placeholder"),this.$results=$("#results"),this.$resultsFooter=$("#results-footer"),this.$resultsFooterText=$("#results-footer-text"),this.$btnFooterSearch=$("#btn-different-search"),this.$btnLoadMore=$("#btn-load-more"),this.$autocompleteTags=$("#search-autocomplete"),this.$btnCancelSearch=$("#btn-cancel-search"),this.$postPlaceholder=$("#post-placeholder"),this.$post=$("#post"),this.$postImage=$("#post-image"),this.$postDownscaleWarning=$("#post-downscale-warning"),this.$btnPrevPost=$("#btn-prev-post"),this.$btnViewFullsize=$("#btn-view-fullsize"),this.$btnOpenOriginalPost=$("#btn-open-original"),this.$btnNextPost=$("#btn-next-post"),this.$btnCopyLink=$("#btn-copy-link"),this.$btnDownload=$("#btn-download"),this.$btnClosePost=$("#btn-close-post"),this.$postInfo=$("#post-info"),this.$postPropertySite=$("#post-property-site"),this.$postPropertyId=$("#post-property-id"),this.$postTagTypes=$("#post-tag-types"),this.$postVideo=$("#post-video"),this.$postInfoHeader=$("#post-info-header"),this.$paneLeft=$("#pane-left"),this.$paneRight=$("#pane-right"),this.$btnHeaderSearch.on("click",this.onHeaderSearchClick.bind(this)),this.$searchInput.on("keydown",this.onSearchInputKeyDown.bind(this)),this.$searchInput.on("input",this.onSearchInputChange.bind(this)),window.addEventListener("click",this.closeSearchByClick.bind(this)),this.$btnClearTags.on("click",(function(e){e.stopPropagation(),t.clearSearchTags()})),this.$btnExitSearch.on("click",(function(e){e.stopPropagation(),t.hideSearchView()})),this.$selectSearchSite.append(i.default.sites.map((function(t){return'<option value="'.concat(t.id,'">').concat(t.name,"</option>")})).join("")),this.$selectSearchSite.on("change",(function(e){var o=i.default.sites.find((function(e){return e.id===t.$selectSearchSite.val()}));i.default.current=o,o.onSelected(),t.$autocompleteTags.empty(),t.$autocompleteTags.hide()})),i.default.current=i.default.sites[0],this.$btnSearch.on("click",(function(e){e.stopPropagation(),t.search()})),this.$btnLoadMore.on("click",(function(e){e.stopPropagation(),t.currentPage++,t.search(!0)})),this.$btnViewFullsize.on("click",(function(e){e.stopPropagation(),window.open(t.openedPost.getFullSizeImage(),"_blank"),t.$btnViewFullsize.trigger("blur")})),this.$btnOpenOriginalPost.on("click",(function(e){e.stopPropagation(),window.open(t.openedPost.originalPost,"_blank"),t.$btnOpenOriginalPost.trigger("blur")})),this.$btnCancelSearch.on("click",this.onSearchCancelClick.bind(this)),this.$btnPrevPost.on("click",this.onPrevPostClick.bind(this)),this.$btnNextPost.on("click",this.onNextPostClick.bind(this)),this.$btnCopyLink.on("click",this.onCopyButtonPressed.bind(this)),this.$btnDownload.on("click",this.onDownloadButtonPressed.bind(this)),this.$btnClosePost.on("click",this.onClosePostClick.bind(this)),$(window).on("keydown",this.onWindowKeyDown.bind(this)),$(window).on("resize",this.onWindowResize.bind(this)),this.onWindowResize(),this.$postInfoHeader.on("click",(function(e){console.log(t.openedPost)})),console.log("Frontend ready!")},t.posts=[],t.searchTags=[],t.currentPage=0,t.currentPost=-1,t.selectedAutocompleteTag=-1,t.searchViewOpen=!1,t.suppressAutocomplete=!1,t.leftColumnHeight=0,t.rightColumnHeight=0,t.postTagTypes={},t.postProperties={},t}();e.default=s},673:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.requiresVideoPlayer=!1}return t.prototype.normalisedHeight=function(){return this.fullHeight/this.fullWidth},t.prototype.getThumbnail=function(){return this.imageResolutions[0]},t.prototype.getLargeImage=function(){return this.imageResolutions[1]||this.imageResolutions[0]},t.prototype.getFullSizeImage=function(){return this.imageResolutions[this.imageResolutions.length-1]},t}();e.default=o},216:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=o(476),r=o(543),a=o(681),i=o(647),s=o(431);function c(t){s.default.sites.push(t),t.onRegistered()}e.default=function(){c(new n.default),c(r.default),c(new a.default),c(new i.default)}},670:function(t,e,o){var n=this&&this.__assign||function(){return n=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},n.apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.SiteTemplate=void 0;var r=o(710);function a(t,e,o,n){return setTimeout((function(){}),0)}var i=function(){function t(){}return t.generateAutocompleterFromURL=function(t,e,o){var a=this;return void 0===o&&(o={}),o.delay=o.delay||0,o.minLength=o.minLength||1,o.delay>0?function(r,i,s,c){var l=a.generateAutocompleterFromURL(t,e,n(n({},o),{delay:0}));return setTimeout(l.bind(r,i,s,c),o.delay)}:function(n,a,i,s){var c=r.default.decompose(n),l=c.negation,u=c.baseTag;if(u.length<(o.minLength||1))return a([]),i(),null;var h=encodeURI(t.replace("{tag}",u));return $.getJSON(h,(function(t){for(var o=[],n=0,r=t;n<r.length;n++){var s=r[n],c=e(s);c.label=l+c.label,c.value=l+c.value,o.push(c)}a(o),i()}))}},t.generateSearcherFromURL=function(t,e){return function(o,n,r,a,i){var s=encodeURI(t.replace("{tags}",o.join(" ")).replace("{page}",n.toString()));return console.log("Searching... "+s),$.getJSON(s,(function(t){for(var o=[],i=0,s=t.post;i<s.length;i++){var c=s[i],l=e(c);l&&o.push(l)}console.log("Search successful"),r(o),a(n,o.length<20)})).fail(i)}},t.GenerateSimpleBooru=function(e){return new(function(){function o(){this.name=e.name,this.id=e.id,this.isPorn=e.isPorn,this.autocompleteEnabled=void 0!==e.autocompleteModule,this.activeAutocompleteRequest=null,this.activeSearchRequest=null,this.autocompleter=e.autocompleteModule?t.generateAutocompleterFromURL(e.autocompleteModule.url,e.autocompleteModule.transformer,{minLength:e.autocompleteModule.minLength,delay:e.autocompleteModule.delay}):a,this.searcher=t.generateSearcherFromURL(e.searchUrl,e.searchTransformer)}return o.prototype.onRegistered=function(){},o.prototype.onSelected=function(){},o.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},o.prototype.autocomplete=function(t,e,o,n){this.abortAutocomplete(),this.activeAutocompleteRequest=this.autocompleter(t,e,o,n)||this.activeAutocompleteRequest},o.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},o.prototype.search=function(t,e,o,n,r){this.abortSearch(),this.activeSearchRequest=this.searcher(t,e,o,n,r)},o}())},t}();e.SiteTemplate=i},431:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.autocompleteEnabled=!1,this.isPorn=!1}return t.prototype.onRegistered=function(){},t.prototype.onSelected=function(){},t.prototype.autocomplete=function(t,e,o,n){n("Autocomplete not implemented")},t.prototype.abortAutocomplete=function(){},t.prototype.search=function(t,e,o,n,r){r("Search not implemented")},t.prototype.abortSearch=function(){},t.sites=[],t}();e.default=o},476:function(t,e,o){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(r,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},s=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var n,r=0,a=e.length;r<a;r++)!n&&r in e||(n||(n=Array.prototype.slice.call(e,0,r)),n[r]=e[r]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var c=o(673),l=o(431),u=o(710),h=o(558),p=o(882),d=o(670),g={g:"General",s:"Sensitive",q:"Questionable",e:"Explicit"},f={0:h.default.General,1:h.default.Artist,3:h.default.Copyright,4:h.default.Character,5:h.default.Meta},m=function(t){function e(){var o=null!==t&&t.apply(this,arguments)||this;return o.name="Danbooru",o.id="danbooru",o.autocompleteEnabled=!0,o.isPorn=!1,o.activeAutocompleteRequest=null,o.activeSearchRequest=null,o.autocompleter=d.SiteTemplate.generateAutocompleterFromURL("https://danbooru.donmai.us/autocomplete.json?only=name,post_count,category&limit=10&search[type]=tag_query&search[query]={tag}",e.autocompleteTransformFunction,{minLength:3}),o}return r(e,t),e.prototype.wait=function(t){return new Promise((function(e){return setTimeout(e,t)}))},e.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},e.autocompleteTransformFunction=function(t){var e=new u.default;return e.label="".concat(t.label," (").concat(t.post_count,")"),e.value=t.value,e.type=f[t.category]||h.default.Other,e},e.prototype.autocomplete=function(t,e,o,n){this.abortAutocomplete(),this.activeSearchRequest=this.autocompleter(t,e,o,n)||this.activeSearchRequest},e.prototype.abortSearch=function(){this.activeSearchRequest&&this.activeSearchRequest.abort()},e.prototype.danbooruPostToBooringPost=function(t){if(!t.preview_file_url&&!t.large_file_url&&!t.file_url)return null;var e=new c.default;return e.site=this,e.id=t.id.toString(),e.imageResolutions=[t.preview_file_url,t.large_file_url,t.file_url],e.fullWidth=t.image_width,e.fullHeight=t.image_height,e.originalPost="https://danbooru.donmai.us/posts/".concat(t.id),e.properties={Date:t.created_at.split("T")[0],Size:"".concat(Math.round(t.file_size/1e3)," KB (").concat(t.image_width,"x").concat(t.image_height,")"),Source:t.source,Rating:g[t.rating],Score:t.score.toString(),Favourites:t.fav_count.toString()},e.tagTypes={Artist:t.tag_string_artist.split(" "),Copyright:t.tag_string_copyright.split(" "),Character:t.tag_string_character.split(" "),General:t.tag_string_general.split(" "),Meta:t.tag_string_meta.split(" ")},e.requiresVideoPlayer=t.large_file_url.endsWith(".webm")||t.large_file_url.endsWith(".mp4")||t.file_url.endsWith(".webm")||t.file_url.endsWith(".mp4"),e},e.prototype.rawSearch=function(t,e,o){var n=this;return new Promise((function(r,a){n.abortSearch();var i=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(e+1,"&limit=").concat(o,"&tags=").concat(t.join(" ")));n.activeSearchRequest=$.getJSON(i,(function(t){r({results:t,endOfResults:t.length<o})})).fail(a)}))},e.prototype.simpleSearch=function(t,e){var o=this;return new Promise((function(n,r){o.abortSearch();var a=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(e+1,"&limit=20&tags=").concat(t.join(" ")));o.activeSearchRequest=$.getJSON(a,(function(t){for(var e=[],r=0,a=t;r<a.length;r++){var i=a[r],s=o.danbooruPostToBooringPost(i);s&&e.push(s)}n({posts:e,endOfResults:t.length<20})})).fail(r)}))},e.prototype.analyseTags=function(t){for(var e=[],o=[],n=[],r=0,a=t;r<a.length;r++){var i=a[r];i.startsWith("-")?n.push(i.substring(1)):i.startsWith("rating:")?e.push(i):o.push(i)}return{untaxedTags:e,taxedTags:o,negatedTags:n}},e.prototype.search=function(t,e,o,n,r){return a(this,void 0,void 0,(function(){var a,c,l,u,h,d,g,f,m,v,y,b,$,w,S,P,T,_,R,x,A,C,O,k,q,I,j,L;return i(this,(function(i){switch(i.label){case 0:if(a=this.analyseTags(t),c=a.untaxedTags,l=a.taxedTags,u=a.negatedTags,!(l.length<3))return[3,5];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.simpleSearch(t,e)];case 2:return A=i.sent(),o(A.posts),n(e,A.endOfResults),[3,4];case 3:return h=i.sent(),r(h),[3,4];case 4:return[2];case 5:d=Array.from(new Set(s(s([],l,!0),u,!0))),i.label=6;case 6:return i.trys.push([6,8,,9]),[4,(0,p.asyncGetJSON)("https://danbooru.donmai.us/tags.json?search[name_comma]=".concat(d.join(",")))];case 7:return g=i.sent(),[3,9];case 8:return f=i.sent(),r(f),[2];case 9:m=g.filter((function(t){return l.includes(t.name)})),v=g.filter((function(t){return u.includes(t.name)})),y=Array.from(m).sort((function(t,e){return t.post_count-e.post_count})).map((function(t){return t.name})),b=Array.from(v).sort((function(t,e){return e.post_count-t.post_count})).map((function(t){return t.name})),$=y.slice(0,2),w=b.slice(0,Math.max(0,2-$.length)),S=s(s(s([],$,!0),w.map((function(t){return"-"+t})),!0),c,!0),P=y.slice($.length),T=b.slice(w.length),console.log(t,S,P,T),_=0,R=0,x=0,i.label=10;case 10:i.label=11;case 11:return i.trys.push([11,14,,15]),[4,this.wait(250)];case 12:return i.sent(),[4,this.rawSearch(S,e+R,30)];case 13:for(A=i.sent(),C=[],O=function(t){var e=t.tag_string.split(" ");if(P.some((function(t){return!e.includes(t)})))return"continue";if(T.some((function(t){return e.includes(t)})))return"continue";var o=k.danbooruPostToBooringPost(t);o&&C.push(o)},k=this,q=0,I=A.results;q<I.length;q++)j=I[q],O(j);return 0===C.length?x++:x=0,o(C),_+=C.length,x>=5||_>=20||A.endOfResults?(n(e+R,A.endOfResults),[2]):[3,15];case 14:return L=i.sent(),r(L),[2];case 15:return R++,[3,10];case 16:return[2]}}))}))},e}(l.default);e.default=m},543:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=o(673),r=o(558),a={general:"General",questionable:"Questionable",explicit:"Explicit"},i={tag:r.default.General,artist:r.default.Artist,copyright:r.default.Copyright,character:r.default.Character,metadata:r.default.Meta},s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],c=o(670).SiteTemplate.GenerateSimpleBooru({name:"Gelbooru",id:"gelbooru",isPorn:!1,autocompleteModule:{url:window.location.origin+"/proxy/json/https://gelbooru.com/index.php?page=autocomplete2&type=tag_query&limit=10&term={tag}",transformer:function(t){return{label:"".concat(t.label," (").concat(t.post_count,")"),value:t.value,type:i[t.category]}}},searchUrl:window.location.origin+"/proxy/json/https://gelbooru.com/index.php?page=dapi&s=post&q=index&json=1&limit=20&pid={page}&tags={tags}",searchTransformer:function(t){var e=new n.default;e.site=c,e.id=t.id.toString(),e.imageResolutions=[t.preview_url,"".concat(window.location.origin,"/gelbooru-img/").concat(t.sample_url),"".concat(window.location.origin,"/gelbooru-img/").concat(t.file_url)],e.fullWidth=t.width,e.fullHeight=t.height,e.originalPost="https://gelbooru.com/index.php?page=post&s=view&id=".concat(t.id);var o=t.created_at.split(" "),r=s.indexOf(o[1])+1,i=o[2],l=o[5].padStart(4,"0")+"-"+String(r).padStart(2,"0")+"-"+i.padStart(2,"0");return e.properties={Date:l,Size:"".concat(t.width,"x").concat(t.height),Source:t.source,Rating:a[t.rating],Score:t.score.toString()},e.tagTypes={Tags:t.tags.split(" ")},e.requiresVideoPlayer=t.sample_url.endsWith(".mp4")||t.sample_url.endsWith(".webm")||t.file_url.endsWith(".mp4")||t.file_url.endsWith(".webm"),e}.bind(null)});e.default=c},647:function(t,e,o){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var a=o(673),i=o(431),s=o(710),c=o(558),l=o(670),u=function(t){function e(){var o=null!==t&&t.apply(this,arguments)||this;return o.name="Safebooru",o.id="safebooru",o.autocompleteEnabled=!0,o.isPorn=!1,o.activeAutocompleteRequest=null,o.activeSearchRequest=null,o.autocompleter=l.SiteTemplate.generateAutocompleterFromURL(window.location.origin+"/proxy/json/https://safebooru.org/autocomplete.php?q={tag}",e.autocompleteTransformFunction,{minLength:1}),o}return r(e,t),e.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(this.activeAutocompleteRequest.abort(),this.activeAutocompleteRequest=null)},e.autocompleteTransformFunction=function(t){var e=new s.default;return e.label=t.label,e.value=t.value,e.type=c.default.General,e},e.prototype.autocomplete=function(t,e,o,n){this.abortAutocomplete(),this.activeAutocompleteRequest=this.autocompleter(t,e,o,n)||this.activeAutocompleteRequest},e.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},e.prototype.search=function(t,e,o,n,r){var i=this;this.abortSearch();var s=encodeURI("".concat(window.location.origin,"/proxy/json/https://safebooru.org/index.php?page=dapi&s=post&q=index&json=1&limit=20&pid=").concat(e,"&tags=").concat(t.join(" ")));console.log("Searching Safebooru... "+s),this.activeSearchRequest=$.getJSON(s,(function(t){for(var r,s,c=[],l=0,u=t;l<u.length;l++){var h=u[l],p=new a.default;p.site=i,p.id=h.id.toString(),p.imageResolutions=["https://safebooru.org/thumbnails/".concat(h.directory,"/thumbnail_").concat(h.image)],h.sample&&p.imageResolutions.push("https://safebooru.org/samples/".concat(h.directory,"/sample_").concat(h.image)),p.imageResolutions.push("https://safebooru.org/images/".concat(h.directory,"/").concat(h.image)),p.fullWidth=h.width,p.fullHeight=h.height,p.originalPost="https://safebooru.org/index.php?page=post&s=view&id=".concat(h.id),p.properties={"Last Updated":new Date(1e3*h.change).toISOString().split("T")[0],Size:"".concat(h.width,"x").concat(h.height),Owner:h.owner||"Unknown",Rating:"General",Score:null!==(s=null===(r=h.score)||void 0===r?void 0:r.toString())&&void 0!==s?s:"0"},p.tagTypes={Tags:h.tags.split(" ")},p.requiresVideoPlayer=h.image.endsWith(".mp4")||h.image.endsWith(".webm"),c.push(p)}console.log("Search successful"),o(c),n(e,c.length<20)})).fail(r)},e}(i.default);e.default=u},681:function(t,e,o){var n,r=this&&this.__extends||(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),a=this&&this.__awaiter||function(t,e,o,n){return new(o||(o=Promise))((function(r,a){function i(t){try{c(n.next(t))}catch(t){a(t)}}function s(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(i,s)}c((n=n.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var o,n,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){i.label=s[1];break}if(6===s[0]&&i.label<r[1]){i.label=r[1],r=s;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(s);break}r[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};Object.defineProperty(e,"__esModule",{value:!0});var s=o(673),c=o(431),l=o(710),u=o(558),h=o(882),p={s:"Safe",q:"Questionable",e:"Explicit"},d={0:u.default.General,1:u.default.Artist,3:u.default.Copyright,4:u.default.Character,5:u.default.Circle},g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Yande.re",e.id="yandere",e.autocompleteEnabled=!1,e.isPorn=!1,e.activeAutocompleteRequest=null,e.activeSearchRequest=null,e}return r(e,t),e.prototype.onSelected=function(){return a(this,void 0,void 0,(function(){var t,e;return i(this,(function(o){switch(o.label){case 0:if(!("1"!=localStorage.getItem("yandere-version")||Date.now()-parseInt(localStorage.getItem("yandere-last-update"))>6048e5))return[3,5];console.log("Fetching Yande.re tags from summary page"),t=void 0,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,(0,h.asyncGetJSON)("https://yande.re/tag/summary.json")];case 2:return t=o.sent(),[3,4];case 3:return e=o.sent(),console.log("Could not fetch Yande.re tags from summary page"),console.error(e),[2];case 4:return localStorage.setItem("yandere-version","1"),localStorage.setItem("yandere-last-update",Date.now().toString()),localStorage.setItem("yandere-tags",t.data),console.log("Updated Yande.re tag cache"),[3,6];case 5:console.log("Found Yande.re tag cache"),o.label=6;case 6:return this.tagCache=localStorage.getItem("yandere-tags"),this.autocompleteEnabled=!0,[2]}}))}))},e.prototype.createTagSearchRegex=function(t,e){void 0===e&&(e={});var o=t.split(""),n=[],r="(([^`]*_)?";if(o.forEach((function(t){var e=t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");r+=e})),r+=")",n.push(r),-1!==t.indexOf("_")){var a=t.split("_",1)[0],i=t.slice(a.length+1),s=a.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),c=i.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");r="(",r+="("+s+"[^`]*_"+c+")",r+="|",r+="("+c+"[^`]*_"+s+")",r+=")",n.push(r)}!e.top_results_only&&o.length<12&&(r="(",o.forEach((function(t){var e=t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&");r+=e,r+="[^`]*"})),r+=")",n.push(r));var l=n.join("|");return new RegExp("(\\d+)[^ ]*`("+l+")[^`]*`[^ ]* ","g")},e.prototype.retrieveTagSearch=function(t,e,o){void 0===o&&(o={});var n=[],r=10;for(void 0!==o.max_results&&(r=o.max_results);n.length<r;){var a=t.exec(e);if(!a)break;var i=a[0];-1===i.indexOf(":deletethistag:")&&-1===n.indexOf(i)&&n.push(i)}return n},e.prototype.reorderSearchResults=function(t,e){var o=this.createTagSearchRegex(t,{top_results_only:!0,global:!1}),n=[],r=[];return e.forEach((function(t){o.test(t)?n.push(t):r.push(t)})),n.concat(r)},e.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&(clearTimeout(this.activeAutocompleteRequest),this.activeAutocompleteRequest=null)},e.prototype.autocomplete=function(t,e,o,n){var r=this;this.abortAutocomplete(),this.activeAutocompleteRequest=setTimeout((function(){var n="";if((t=t.trim()).startsWith("-")&&(n="-",t=t.substring(1)),0==t.length)return e([]),void o();var a=r.createTagSearchRegex(t,{global:!0}),i=r.retrieveTagSearch(a,r.tagCache,{max_results:100});i=(i=r.reorderSearchResults(t,i)).slice(0,10),-1!="sqe".indexOf(t)&&i.unshift("0`"+t+"` ");for(var s=[],c=0,h=i;c<h.length;c++){var p=h[c],g=p.match(/(\d+)`([^`]*)`(([^ ]*)`)? /);if(!g)return void console.error("Unparsable cached tag: '"+p+"'");var f=new l.default;f.value=n+g[2],f.label=f.value,f.type=d[g[1]]||u.default.Other,s.push(f)}e(s),o()}),333)},e.prototype.abortSearch=function(){this.activeSearchRequest&&(this.activeSearchRequest.abort(),this.activeSearchRequest=null)},e.prototype.search=function(t,e,o,n,r){var a=this;this.abortSearch();var i=encodeURI("https://yande.re/post.json?page=".concat(e+1,"&tags=").concat(t.join(",")));console.log("Searching Yande.re... "+i),this.activeSearchRequest=$.getJSON(i,(function(t){var r=[];console.log(t);for(var i=0,c=t;i<c.length;i++){var l=c[i],u=new s.default;u.site=a,u.id=l.id.toString(),u.imageResolutions=[l.preview_url,"".concat(window.location.origin,"/yandere-img/").concat(l.sample_url),"".concat(window.location.origin,"/yandere-img/").concat(l.file_url)],u.fullWidth=l.width,u.fullHeight=l.height,u.originalPost="https://yande.re/post/show/".concat(l.id),u.properties={Uploader:l.author,Date:new Date(l.created_at).toISOString().split("T")[0],Size:"".concat(Math.round(l.file_size/1e3)," KB (").concat(l.width,"x").concat(l.height,")"),Source:""==l.source?"Unknown":l.source,Rating:p[l.rating],Score:l.score.toString()},u.tagTypes={Tags:l.tags.split(" ")},r.push(u)}console.log("Search successful"),o(r),n(e,r.length<20)})).fail(r)},e}(c.default);e.default=g},558:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Artist="artist",t.Copyright="copyright",t.Character="character",t.General="general",t.Meta="meta",t.Circle="circle",t.Other="other"}(o||(o={})),e.default=o},882:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.asyncGetJSON=void 0,e.asyncGetJSON=function(t){return new Promise((function(e,o){$.getJSON(t,e).fail(o)}))}}},o={};function n(t){var r=o[t];if(void 0!==r)return r.exports;var a=o[t]={exports:{}};return e[t].call(a.exports,a,a.exports,n),a.exports}t=n(263),(0,n(216).default)(),$(t.default.main.bind(t.default))})();