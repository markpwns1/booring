(()=>{"use strict";var t,e={710:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});e.default=function(){}},263:function(t,e,o){var s=this&&this.__awaiter||function(t,e,o,s){return new(o||(o=Promise))((function(n,i){function r(t){try{c(s.next(t))}catch(t){i(t)}}function a(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))},n=this&&this.__generator||function(t,e){var o,s,n,i,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(r=0)),r;)try{if(o=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((n=(n=r.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){r.label=a[1];break}if(6===a[0]&&r.label<n[1]){r.label=n[1],n=a;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(a);break}n[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],s=0}finally{o=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},i=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var s,n=0,i=e.length;n<i;n++)!s&&n in e||(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var r=o(431),a=function(){function t(){}return t.onHeaderSearchClick=function(t){t.stopPropagation(),this.searchViewOpen?this.hideSearchView():this.showSearchView()},t.closeSearchByClick=function(t){this.searchViewOpen&&!this.$viewSearch[0].contains(t.target)&&(this.$viewSearch.hide(),this.searchViewOpen=!1,t.preventDefault())},t.onSearchInputKeyDown=function(t){if("Enter"===t.key){if(""===this.$searchInput.val())return void this.search();if(this.selectedAutocompleteTag>-1)(o=this.$autocompleteTags.children()).eq(this.selectedAutocompleteTag).trigger("click");else{var e=this.$searchInput.val();this.addSearchTag(e),this.$searchInput.val(""),this.$autocompleteTags.empty(),this.$autocompleteTags.hide()}}else if("ArrowDown"==t.key){t.preventDefault(),this.selectedAutocompleteTag++;var o=this.$autocompleteTags.children();this.selectedAutocompleteTag>=o.length&&(this.selectedAutocompleteTag=0),this.selectAutocompleteTag(this.selectedAutocompleteTag)}else"ArrowUp"==t.key?(t.preventDefault(),this.selectedAutocompleteTag--,this.selectedAutocompleteTag<0&&(this.selectedAutocompleteTag=this.$autocompleteTags.children().length-1),this.selectAutocompleteTag(this.selectedAutocompleteTag)):"Escape"==t.key&&(this.selectedAutocompleteTag>-1?this.unselectAutocompleteTags():this.hideSearchView())},t.onSearchInputChange=function(){var t=this;this.suppressAutocomplete?this.suppressAutocomplete=!1:r.default.current.autocomplete(this.$searchInput.val(),(function(e){t.updateAutocompleteTags(e)}),(function(){}),(function(t){console.error(t)}))},t.onSearchCancelClick=function(t){t.stopPropagation(),this.$resultsFooterText.text("Currently showing "+this.posts.length+' images.\n\nNote that due to technical limitations, if you click "Show more...", you will get some repeat posts.'),this.$btnFooterSearch.hide(),this.$btnLoadMore.show(),this.$btnCancelSearch.hide(),r.default.current.abortSearch()},t.onNextPostClick=function(t){var e=this;null==t||t.stopPropagation(),this.currentPost<this.posts.length-1&&this.openPost(this.posts[++this.currentPost],(function(){e.currentPost<e.posts.length-1&&e.preloadImage(e.posts[e.currentPost+1].getLargeImage(),(function(t){e.cachedImage=t}))})),this.$btnNextPost.trigger("blur")},t.onPrevPostClick=function(t){var e=this;null==t||t.stopPropagation(),this.currentPost>0&&this.openPost(this.posts[--this.currentPost],(function(){e.currentPost>0&&e.preloadImage(e.posts[e.currentPost-1].getLargeImage(),(function(t){e.cachedImage=t}))})),this.$btnPrevPost.trigger("blur")},t.onWindowKeyDown=function(t){this.openedPost&&("ArrowRight"===t.key?this.onNextPostClick():"ArrowLeft"===t.key&&this.onPrevPostClick())},t.onCopyButtonPressed=function(t){var e=this;t.stopPropagation();var o="".concat(window.location.origin,"/post/").concat(this.openedPost.site.id,"/").concat(this.openedPost.id),s=document.createElement("textarea");s.style.position="fixed",s.style.top="0",s.style.left="0",s.style.width="2em",s.style.height="2em",s.style.padding="0",s.style.border="none",s.style.outline="none",s.style.boxShadow="none",s.style.background="transparent",s.value=o,document.body.appendChild(s),s.focus(),s.select();try{var n=document.execCommand("copy")?"successful":"unsuccessful";console.log("Copying text command was "+n)}catch(t){console.log("Oops, unable to copy")}document.body.removeChild(s),this.$btnCopyLink.text("Copied!"),setTimeout((function(){e.$btnCopyLink.text("Copy link")}),2e3),this.$btnCopyLink.trigger("blur")},t.onDownloadButtonPressed=function(t){t.stopPropagation();var e=window.location.origin+"/download/"+this.openedPost.getFullSizeImage(),o=e.split(".").pop(),s="".concat(this.openedPost.site.id,"-").concat(this.openedPost.id,".").concat(o),n=document.createElement("a");n.href=e,n.download=s,document.body.appendChild(n),n.click(),document.body.removeChild(n),this.$btnDownload.trigger("blur")},t.onClosePostClick=function(t){t.stopPropagation(),this.$postPlaceholder.show(),this.$post.hide(),this.$postVideo.trigger("pause"),this.$postVideo.attr("src",""),this.$postVideo.attr("poster",""),this.$postImage.attr("src",""),this.$postDownscaleWarning.hide(),window.innerWidth<1e3&&(this.$paneLeft.show(),this.$paneRight.hide()),this.openedPost=void 0},t.onWindowResize=function(){!this.openedPost&&window.innerWidth<1e3&&this.$paneRight.hide()},t.arraySetEquals=function(t,e){if(void 0===t||void 0===e)return!1;if(t===e)return!0;if(t.length!==e.length)return!1;for(var o=0,s=t;o<s.length;o++){var n=s[o];if(!e.includes(n))return!1}for(var i=0,r=e;i<r.length;i++)if(n=r[i],!t.includes(n))return!1;return!0},t.preloadImage=function(t,e){var o=new Image;o.onload=e.bind(this,o),o.src=t},t.search=function(t){var e=this;void 0===t&&(t=!1),!t&&this.lastSearch&&r.default.current==this.lastSearch.site&&this.arraySetEquals(this.searchTags,this.lastSearch.tags)&&this.currentPage==this.lastSearch.page?console.log("Same search. Cancelling."):(console.log("Searching: "+this.searchTags.join(", ")),t||(this.currentPage=0),this.$resultsPlaceholder.hide(),this.$results.show(),this.$resultsFooter.show(),this.$resultsFooterText.text("Loading..."),this.$btnFooterSearch.hide(),this.$btnLoadMore.hide(),this.$btnCancelSearch.show(),t||this.clearResults(),this.lastSearch={tags:i([],this.searchTags,!0),page:this.currentPage,site:r.default.current},r.default.current.search(this.searchTags,this.currentPage,(function(t){return s(e,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,Promise.all(t.map(this.addPost.bind(this)))];case 1:return e.sent(),[2]}}))}))}),(function(t,o){e.currentPage=t,o?(e.$resultsFooterText.text("No more images found."),e.$btnFooterSearch.show(),e.$btnLoadMore.hide(),e.$btnCancelSearch.hide()):(e.$resultsFooterText.text(""),e.$btnFooterSearch.hide(),e.$btnLoadMore.show(),e.$btnCancelSearch.hide())}),(function(t){return console.error(t)})),this.hideSearchView())},t.clearResults=function(){this.$resultsLeftColumn.empty(),this.$resultsRightColumn.empty(),this.leftColumnHeight=0,this.rightColumnHeight=0,this.posts=[]},t.addPost=function(t){var e=this;return new Promise((function(o,s){var n=new Image;n.onload=function(){e.leftColumnHeight<e.rightColumnHeight?(e.$resultsLeftColumn.append(n),e.leftColumnHeight+=t.normalisedHeight()):(e.$resultsRightColumn.append(n),e.rightColumnHeight+=t.normalisedHeight()),e.posts.push(t),o()},n.onclick=function(o){o.stopPropagation(),e.openPost(t)},n.onerror=s,n.src=t.getThumbnail(),n.className="results-image"}))},t.unselectAutocompleteTags=function(){this.selectedAutocompleteTag=-1,this.$autocompleteTags.children().removeClass("selected")},t.selectAutocompleteTag=function(t){if(this.selectedAutocompleteTag=t,!(this.selectedAutocompleteTag<0)){var e=this.$autocompleteTags.children();this.selectedAutocompleteTag>=e.length||(e.removeClass("selected"),e.eq(this.selectedAutocompleteTag).addClass("selected"))}},t.updateAutocompleteTags=function(t){var e=this;if(this.unselectAutocompleteTags(),0!=t.length){this.$autocompleteTags.show(),this.$autocompleteTags.empty();for(var o=function(t){var o=$('<button class="autocomplete-tag tag-'.concat(t.type,'">').concat(t.value," ").concat(t.count?" ("+t.count+")":"","</button>"));o.on("click touchstart",(function(o){e.suppressAutocomplete=!0,o.stopPropagation(),o.preventDefault(),e.addSearchTag(t.value),e.$searchInput.val(""),e.$autocompleteTags.empty(),e.$autocompleteTags.hide()})),s.$autocompleteTags.append(o)},s=this,n=0,i=t;n<i.length;n++)o(i[n])}else this.$autocompleteTags.hide()},t.showSearchView=function(){this.$viewSearch.show(),this.searchViewOpen=!0,this.$searchInput.trigger("focus")},t.hideSearchView=function(){this.$viewSearch.hide(),this.searchViewOpen=!1,this.$searchInput.val(""),this.$autocompleteTags.hide(),this.$autocompleteTags.empty(),this.unselectAutocompleteTags()},t.addSearchTag=function(t){var e=this;if(t=t.trim(),!this.searchTags.includes(t)){this.searchTags.push(t);var o=$('<span class="search-tag">'.concat(t,' <span class="search-tag-close">&#x2715</span></span>'));o.one("click",(function(s){s.stopPropagation(),e.searchTags.splice(e.searchTags.indexOf(t),1),o.remove(),0===e.searchTags.length&&(e.$searchTagDisplay.hide(),e.$searchTagHeaderNoTags.show())})),this.$searchTagHeaderNoTags.hide(),this.$searchCurrentTags.append(o),this.$searchTagDisplay.show()}},t.clearSearchTags=function(){this.searchTags=[],this.$searchCurrentTags.empty(),this.$searchTagDisplay.hide(),this.$searchTagHeaderNoTags.show()},t.openPost=function(t,e){var o=this;if(!this.openedPost||this.openedPost.id!==t.id){if(window.innerWidth<1e3?this.$paneLeft.hide():this.$paneLeft.show(),this.$postPlaceholder.hide(),this.$post.show(),this.$paneRight.show(),this.currentPost=this.posts.indexOf(t),console.log("Opening post "+this.currentPost),this.$postPlaceholder.hide(),this.$post.show(),t.requiresVideoPlayer)this.$postImage.hide(),this.$postVideo.show(),this.$postVideo.attr("poster",t.getThumbnail()),this.$postVideo.attr("src",t.getLargeImage()),this.$postVideo.trigger("play");else{this.$postVideo.hide(),this.$postImage.show();var s=this.cachedImage&&this.cachedImage.src===t.getLargeImage()?1:0;this.$postImage.attr("src",t.imageResolutions[s]);var n=this.$postImage[0];n.onload=function(){s>0&&e&&e();var i=Math.round(n.height/n.naturalHeight*100),r=Math.round(n.naturalHeight/t.fullHeight*100);n.naturalHeight<n.height&&i>175&&s<t.imageResolutions.length-1&&(s++,o.$postImage.attr("src",t.imageResolutions[s])),r<100?(o.$postDownscaleWarning.show(),o.$postDownscaleWarning.text("Resized to ".concat(r,"% of original"))):o.$postDownscaleWarning.hide()},n.onerror=function(){o.$postImage.attr("src",t.getThumbnail())}}if(this.$postInfoHeader.text("".concat(t.site.name," #").concat(t.id)),this.openedPost&&this.openedPost.site===t.site){for(var i in t.properties)this.postProperties[i].html("<b>".concat(i,"</b>: ").concat(t.properties[i]));for(var i in t.tagTypes)this.postTagTypes[i].text(t.tagTypes[i].join(" "))}else{for(var i in this.$postInfo.empty(),t.properties)if(t.properties[i]){var r=$('<span class="post-property"><b>'.concat(i,"</b>: ").concat(t.properties[i],"</span>"));this.postProperties[i]=r,this.$postInfo.append(r)}for(var i in this.$postTagTypes.empty(),t.tagTypes){var a=t.tagTypes[i];if(a&&0!=a.length){var c=$('<div class="post-tag-type"></div>'),l=$('<h3 class="post-tag-type-header"><b>'.concat(i,"</b></h3>"));c.append(l);var h=$('<span class="post-tag-list tag-'.concat(i.toLowerCase(),'">').concat(a.join(" "),"</span>"));c.append(h),this.postTagTypes[i]=h,this.$postTagTypes.append(c)}}}0===this.currentPost?this.$btnPrevPost.addClass("invisible"):this.$btnPrevPost.removeClass("invisible"),this.currentPost===this.posts.length-1?this.$btnNextPost.addClass("invisible"):this.$btnNextPost.removeClass("invisible"),this.openedPost=t}},t.main=function(){var t=this;this.$btnHeaderSearch=$("#header-search, #results-placeholder, #btn-different-search"),this.$viewSearch=$("#view-search"),this.$viewSearch.hide(),this.$searchInput=$("#search-input"),this.$searchCurrentTags=$("#search-current-tags"),this.$searchTagHeaderNoTags=$("#search-tag-header-no-tags"),this.$searchTagDisplay=$("#search-tag-display"),this.$searchTagDisplay.hide(),this.$btnClearTags=$("#btn-clear"),this.$btnExitSearch=$("#btn-exit-search"),this.$selectSearchSite=$("#search-site"),this.$btnSearch=$("#btn-search"),this.$resultsLeftColumn=$("#results-column-left"),this.$resultsRightColumn=$("#results-column-right"),this.$resultsPlaceholder=$("#results-placeholder"),this.$results=$("#results"),this.$resultsFooter=$("#results-footer"),this.$resultsFooterText=$("#results-footer-text"),this.$btnFooterSearch=$("#btn-different-search"),this.$btnLoadMore=$("#btn-load-more"),this.$autocompleteTags=$("#search-autocomplete"),this.$btnCancelSearch=$("#btn-cancel-search"),this.$postPlaceholder=$("#post-placeholder"),this.$post=$("#post"),this.$postImage=$("#post-image"),this.$postDownscaleWarning=$("#post-downscale-warning"),this.$btnPrevPost=$("#btn-prev-post"),this.$btnViewFullsize=$("#btn-view-fullsize"),this.$btnOpenOriginalPost=$("#btn-open-original"),this.$btnNextPost=$("#btn-next-post"),this.$btnCopyLink=$("#btn-copy-link"),this.$btnDownload=$("#btn-download"),this.$btnClosePost=$("#btn-close-post"),this.$postInfo=$("#post-info"),this.$postPropertySite=$("#post-property-site"),this.$postPropertyId=$("#post-property-id"),this.$postTagTypes=$("#post-tag-types"),this.$postVideo=$("#post-video"),this.$postInfoHeader=$("#post-info-header"),this.$paneLeft=$("#pane-left"),this.$paneRight=$("#pane-right"),this.$btnHeaderSearch.on("click",this.onHeaderSearchClick.bind(this)),this.$searchInput.on("keydown",this.onSearchInputKeyDown.bind(this)),this.$searchInput.on("input",this.onSearchInputChange.bind(this)),window.addEventListener("click",this.closeSearchByClick.bind(this)),this.$btnClearTags.on("click",(function(e){e.stopPropagation(),t.clearSearchTags()})),this.$btnExitSearch.on("click",(function(e){e.stopPropagation(),t.hideSearchView()})),this.$selectSearchSite.append(r.default.sites.map((function(t){return'<option value="'.concat(t.id,'">').concat(t.name,"</option>")})).join("")),this.$selectSearchSite.on("change",(function(e){var o=r.default.sites.find((function(e){return e.id===t.$selectSearchSite.val()}));r.default.current=o})),r.default.current=r.default.sites[0],this.$btnSearch.on("click",(function(e){e.stopPropagation(),t.search()})),this.$btnLoadMore.on("click",(function(e){e.stopPropagation(),t.currentPage++,t.search(!0)})),this.$btnViewFullsize.on("click",(function(e){e.stopPropagation(),window.open(t.openedPost.getFullSizeImage(),"_blank"),t.$btnViewFullsize.trigger("blur")})),this.$btnOpenOriginalPost.on("click",(function(e){e.stopPropagation(),window.open(t.openedPost.originalPost,"_blank"),t.$btnOpenOriginalPost.trigger("blur")})),this.$btnCancelSearch.on("click",this.onSearchCancelClick.bind(this)),this.$btnPrevPost.on("click",this.onPrevPostClick.bind(this)),this.$btnNextPost.on("click",this.onNextPostClick.bind(this)),this.$btnCopyLink.on("click",this.onCopyButtonPressed.bind(this)),this.$btnDownload.on("click",this.onDownloadButtonPressed.bind(this)),this.$btnClosePost.on("click",this.onClosePostClick.bind(this)),$(window).on("keydown",this.onWindowKeyDown.bind(this)),$(window).on("resize",this.onWindowResize.bind(this)),this.onWindowResize(),this.$postInfoHeader.on("click",(function(e){console.log(t.openedPost)})),console.log("Frontend ready!")},t.posts=[],t.searchTags=[],t.currentPage=0,t.currentPost=-1,t.selectedAutocompleteTag=-1,t.searchViewOpen=!1,t.suppressAutocomplete=!1,t.leftColumnHeight=0,t.rightColumnHeight=0,t.postTagTypes={},t.postProperties={},t}();e.default=a},673:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.requiresVideoPlayer=!1}return t.prototype.normalisedHeight=function(){return this.fullHeight/this.fullWidth},t.prototype.getThumbnail=function(){return this.imageResolutions[0]},t.prototype.getLargeImage=function(){return this.imageResolutions[1]||this.imageResolutions[0]},t.prototype.getFullSizeImage=function(){return this.imageResolutions[this.imageResolutions.length-1]},t}();e.default=o},216:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0});var s=o(476),n=o(543),i=o(431);function r(t){i.default.sites.push(t),t.onRegistered()}e.default=function(){r(new s.default),r(new n.default)}},431:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(){this.autocompleteEnabled=!1,this.isPorn=!1}return t.prototype.onRegistered=function(){},t.prototype.onSelected=function(){},t.prototype.wait=function(t){return new Promise((function(e){return setTimeout(e,t)}))},t.prototype.autocomplete=function(t,e,o,s){s("Autocomplete not implemented")},t.prototype.abortAutocomplete=function(){},t.prototype.search=function(t,e,o,s,n){n("Search not implemented")},t.prototype.abortSearch=function(){},t.sites=[],t}();e.default=o},476:function(t,e,o){var s,n=this&&this.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),i=this&&this.__awaiter||function(t,e,o,s){return new(o||(o=Promise))((function(n,i){function r(t){try{c(s.next(t))}catch(t){i(t)}}function a(t){try{c(s.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}c((s=s.apply(t,e||[])).next())}))},r=this&&this.__generator||function(t,e){var o,s,n,i,r={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(o)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(r=0)),r;)try{if(o=1,s&&(n=2&a[0]?s.return:a[0]?s.throw||((n=s.return)&&n.call(s),0):s.next)&&!(n=n.call(s,a[1])).done)return n;switch(s=0,n&&(a=[2&a[0],n.value]),a[0]){case 0:case 1:n=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,s=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((n=(n=r.trys).length>0&&n[n.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!n||a[1]>n[0]&&a[1]<n[3])){r.label=a[1];break}if(6===a[0]&&r.label<n[1]){r.label=n[1],n=a;break}if(n&&r.label<n[2]){r.label=n[2],r.ops.push(a);break}n[2]&&r.ops.pop(),r.trys.pop();continue}a=e.call(t,r)}catch(t){a=[6,t],s=0}finally{o=n=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},a=this&&this.__spreadArray||function(t,e,o){if(o||2===arguments.length)for(var s,n=0,i=e.length;n<i;n++)!s&&n in e||(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0});var c=o(673),l=o(431),h=o(710),u=o(558),p=o(882),d={g:"General",s:"Sensitive",q:"Questionable",e:"Explicit"},g={0:u.default.General,1:u.default.Artist,3:u.default.Copyright,4:u.default.Character,5:u.default.Meta},f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Danbooru",e.id="danbooru",e.autocompleteEnabled=!0,e.isPorn=!1,e.activeAutocompleteRequest=null,e.activeSearchRequest=null,e}return n(e,t),e.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&this.activeAutocompleteRequest.abort()},e.prototype.autocomplete=function(t,e,o,s){this.abortAutocomplete(),t=t.trim();var n="";if(t.startsWith("-")&&(n="-",t=t.substring(1)),t.length<3)o();else{var i=encodeURI("https://danbooru.donmai.us/autocomplete.json?only=name,post_count,category&limit=10&search[type]=tag_query&search[query]=".concat(t));this.activeAutocompleteRequest=$.getJSON(i,(function(t){for(var s=[],i=0,r=t;i<r.length;i++){var a=r[i],c=new h.default;c.value=n+a.value,c.type=g[a.category]||u.default.Other,c.count=a.post_count,s.push(c)}e(s),o()})).fail((function(t){"abort"!==t.statusText&&s(t)}))}},e.prototype.abortSearch=function(){this.activeSearchRequest&&this.activeSearchRequest.abort()},e.prototype.danbooruPostToBooringPost=function(t){if(!t.preview_file_url&&!t.large_file_url&&!t.file_url)return null;var e=new c.default;return e.site=this,e.id=t.id.toString(),e.imageResolutions=[t.preview_file_url,t.large_file_url,t.file_url],e.fullWidth=t.image_width,e.fullHeight=t.image_height,e.originalPost="https://danbooru.donmai.us/posts/".concat(t.id),e.properties={Date:t.created_at.split("T")[0],Size:"".concat(Math.round(t.file_size/1e3)," KB (").concat(t.image_width,"x").concat(t.image_height,")"),Source:t.source,Rating:d[t.rating],Score:t.score.toString(),Favourites:t.fav_count.toString()},e.tagTypes={Artist:t.tag_string_artist.split(" "),Copyright:t.tag_string_copyright.split(" "),Character:t.tag_string_character.split(" "),General:t.tag_string_general.split(" "),Meta:t.tag_string_meta.split(" ")},e.requiresVideoPlayer=t.large_file_url.endsWith(".webm")||t.large_file_url.endsWith(".mp4")||t.file_url.endsWith(".webm")||t.file_url.endsWith(".mp4"),e},e.prototype.rawSearch=function(t,e,o){var s=this;return new Promise((function(n,i){s.abortSearch();var r=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(e+1,"&limit=").concat(o,"&tags=").concat(t.join(" ")));s.activeSearchRequest=$.getJSON(r,(function(t){n({results:t,endOfResults:t.length<o})})).fail(i)}))},e.prototype.simpleSearch=function(t,e){var o=this;return new Promise((function(s,n){o.abortSearch();var i=encodeURI("https://danbooru.donmai.us/posts.json?page=".concat(e+1,"&limit=20&tags=").concat(t.join(" ")));o.activeSearchRequest=$.getJSON(i,(function(t){for(var e=[],n=0,i=t;n<i.length;n++){var r=i[n],a=o.danbooruPostToBooringPost(r);a&&e.push(a)}s({posts:e,endOfResults:t.length<20})})).fail(n)}))},e.prototype.analyseTags=function(t){for(var e=[],o=[],s=[],n=0,i=t;n<i.length;n++){var r=i[n];r.startsWith("-")?s.push(r.substring(1)):r.startsWith("rating:")?e.push(r):o.push(r)}return{untaxedTags:e,taxedTags:o,negatedTags:s}},e.prototype.search=function(t,e,o,s,n){return i(this,void 0,void 0,(function(){var i,c,l,h,u,d,g,f,m,$,b,y,v,w,P,S,T,_,C,x,A,k,R,O,I,j,q,H;return r(this,(function(r){switch(r.label){case 0:if(i=this.analyseTags(t),c=i.untaxedTags,l=i.taxedTags,h=i.negatedTags,!(l.length<3))return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.simpleSearch(t,e)];case 2:return A=r.sent(),o(A.posts),s(e,A.endOfResults),[3,4];case 3:return u=r.sent(),n(u),[3,4];case 4:return[2];case 5:d=Array.from(new Set(a(a([],l,!0),h,!0))),r.label=6;case 6:return r.trys.push([6,8,,9]),[4,(0,p.asyncGetJSON)("https://danbooru.donmai.us/tags.json?search[name_comma]=".concat(d.join(",")))];case 7:return g=r.sent(),[3,9];case 8:return f=r.sent(),n(f),[2];case 9:m=g.filter((function(t){return l.includes(t.name)})),$=g.filter((function(t){return h.includes(t.name)})),b=Array.from(m).sort((function(t,e){return t.post_count-e.post_count})).map((function(t){return t.name})),y=Array.from($).sort((function(t,e){return e.post_count-t.post_count})).map((function(t){return t.name})),v=b.slice(0,2),w=y.slice(0,Math.max(0,2-v.length)),P=a(a(a([],v,!0),w.map((function(t){return"-"+t})),!0),c,!0),S=b.slice(v.length),T=y.slice(w.length),console.log(t,P,S,T),_=0,C=0,x=0,r.label=10;case 10:r.label=11;case 11:return r.trys.push([11,14,,15]),[4,this.wait(250)];case 12:return r.sent(),[4,this.rawSearch(P,e+C,30)];case 13:for(A=r.sent(),k=[],R=function(t){var e=t.tag_string.split(" ");if(S.some((function(t){return!e.includes(t)})))return"continue";if(T.some((function(t){return e.includes(t)})))return"continue";var o=O.danbooruPostToBooringPost(t);o&&k.push(o)},O=this,I=0,j=A.results;I<j.length;I++)q=j[I],R(q);return 0===k.length?x++:x=0,o(k),_+=k.length,x>=5||_>=20||A.endOfResults?(s(e+C,A.endOfResults),[2]):[3,15];case 14:return H=r.sent(),n(H),[2];case 15:return C++,[3,10];case 16:return[2]}}))}))},e}(l.default);e.default=f},543:function(t,e,o){var s,n=this&&this.__extends||(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)});Object.defineProperty(e,"__esModule",{value:!0});var i=o(673),r=o(431),a=o(710),c=o(558),l={general:"General",questionable:"Questionable",explicit:"Explicit"},h={tag:c.default.General,artist:c.default.Artist,copyright:c.default.Copyright,character:c.default.Character,metadata:c.default.Meta},u=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="Gelbooru",e.id="gelbooru",e.autocompleteEnabled=!0,e.isPorn=!1,e.activeAutocompleteRequest=null,e.activeSearchRequest=null,e}return n(e,t),e.prototype.abortAutocomplete=function(){this.activeAutocompleteRequest&&this.activeAutocompleteRequest.abort()},e.prototype.autocomplete=function(t,e,o,s){this.abortAutocomplete(),t=t.trim();var n="";t.startsWith("-")&&(n="-",t=t.substring(1));var i=encodeURI("/proxy/json/https://gelbooru.com/index.php?page=autocomplete2&type=tag_query&limit=10&term=".concat(t));this.activeAutocompleteRequest=$.getJSON(i,(function(t){for(var s=[],i=0,r=t;i<r.length;i++){var c=r[i],l=new a.default;l.value=n+c.value,l.count=parseInt(c.post_count),l.type=h[c.category],s.push(l)}e(s),o()})).fail((function(t){"abort"!==t.statusText&&s(t)}))},e.prototype.abortSearch=function(){this.activeSearchRequest&&this.activeSearchRequest.abort()},e.prototype.search=function(t,e,o,s,n){var r=this;this.abortSearch();var a=encodeURI("/proxy/json/https://gelbooru.com/index.php?page=dapi&s=post&q=index&json=1&limit=20&pid=".concat(e,"&tags=").concat(t.join(" ")));console.log("Searching Gelbooru... "+a),this.activeSearchRequest=$.getJSON(a,(function(t){for(var n=[],a=0,c=t.post;a<c.length;a++){var h=c[a],p=new i.default;p.site=r,p.id=h.id.toString(),p.imageResolutions=[h.preview_url,"".concat(window.location.origin,"/gelbooru-img/").concat(h.sample_url),"".concat(window.location.origin,"/gelbooru-img/").concat(h.file_url)],p.fullWidth=h.width,p.fullHeight=h.height,p.originalPost="https://gelbooru.com/index.php?page=post&s=view&id=".concat(h.id);var d=h.created_at.split(" "),g=u.indexOf(d[1])+1,f=d[2],m=d[5].padStart(4,"0")+"-"+String(g).padStart(2,"0")+"-"+f.padStart(2,"0");p.properties={Date:m,Size:"".concat(h.width,"x").concat(h.height),Source:h.source,Rating:l[h.rating],Score:h.score.toString()},p.tagTypes={Tags:h.tags.split(" ")},n.push(p)}console.log("Search successful"),o(n),s(e,n.length<20)})).fail(n)},e}(r.default);e.default=p},558:(t,e)=>{var o;Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.Artist="artist",t.Copyright="copyright",t.Character="character",t.General="general",t.Meta="meta",t.Other="other"}(o||(o={})),e.default=o},882:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.asyncGetJSON=void 0,e.asyncGetJSON=function(t){return new Promise((function(e,o){$.getJSON(t,e).fail(o)}))}}},o={};function s(t){var n=o[t];if(void 0!==n)return n.exports;var i=o[t]={exports:{}};return e[t].call(i.exports,i,i.exports,s),i.exports}t=s(263),(0,s(216).default)(),$(t.default.main.bind(t.default))})();